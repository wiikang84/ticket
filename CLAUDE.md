# 공연 통합 정보 시스템

## 프로젝트 개요
- **목적**: 공연(콘서트/뮤지컬/연극) 티켓팅 통합 조회 시스템
- **버전**: v3.1
- **시작일**: 2026-01-28
- **업데이트**: 12시간 단위 (00시, 12시)

## v3.1 변경사항 (2026-01-30)
- **7개 권역 지역 분류**: 서울 / 경기·인천 / 강원 / 충청 / 전라 / 경상 / 제주
- **지역 분류 로직**: KOPIS area 필드 + 공연장 키워드 매칭
- **UI 추가**:
  - 지역 필터 탭 (7개 권역 + 전체)
  - 카드에 지역 뱃지 (컬러코딩)
  - 캘린더 지역별 필터링
- **region 필드 추가**: 모든 공연 데이터에 지역 분류 포함

## v3.0 변경사항 (2026-01-29)
- **2개 파트 분류**: 콘서트 / 연극 & 뮤지컬
- **KOPIS 장르 확장**: 대중음악(CCCD) + 뮤지컬(GGGA) + 연극(AAAA)
- **YES24 장르 확장**: 콘서트(15457) + 뮤지컬(15458) + 연극(15459)
- **UI 개선**:
  - 홈버튼 추가 (초기화)
  - 파트 탭 (콘서트/연극&뮤지컬)
  - 소스 필터 탭 (전체/KOPIS/인터파크/멜론/YES24)
  - 캘린더 파트별 필터링
- **part 필드 추가**: 모든 공연 데이터에 'concert' 또는 'theater' 분류

## 데이터 소스

### 1. KOPIS API (공연예술통합전산망)
- **API 키**: `2012e419e6c24bfa988ca56e2917d3c0`
- **조회 장르**:
  - 대중음악/콘서트 (CCCD) -> part: concert
  - 뮤지컬 (GGGA) -> part: theater
  - 연극 (AAAA) -> part: theater
- **제공 데이터**: 공연명, 공연일, 장소, 포스터, 가격, 출연진, **예매처 링크**
- **예매처 정보**: relates 태그에서 인터파크/멜론/YES24 실제 링크 제공

### 2. 인터파크 (NOL 티켓)
- **URL**: tickets.interpark.com
- **크롤링 페이지**: `/contents/genre/concert` (콘서트만)
- **수집 방식**: JSON 파싱 (goodsCode, goodsName, placeName, posterImageUrl)
- **수집 데이터**: 공연명, 날짜, 장소, 포스터, 상품링크

### 3. 멜론티켓 (Selenium)
- **URL**: ticket.melon.com
- **수집 방식**: Selenium (헤드리스 크롬)
- **수집 데이터**: 공연명, 날짜, 장소, 포스터, 상품링크

### 4. YES24 티켓 (Selenium)
- **URL**: ticket.yes24.com
- **수집 방식**: Selenium (undetected-chromedriver, 봇 차단 우회)
- **크롤링 페이지**:
  - `/genre=15457` (콘서트) -> part: concert
  - `/genre=15458` (뮤지컬) -> part: theater
  - `/genre=15459` (연극) -> part: theater
- **수집 데이터**: 공연명, 날짜, 장소, 포스터, 상품링크, 파트

## 콘서트 세부 장르 분류 (v2.2 확장)

| 카테고리 | 키워드 예시 (총 200+ 키워드) |
|----------|-------------|
| 아이돌 | BTS, 에이핑크, 제로베이스원, 르세라핌, NCT, 엑소, 샤이니, 레드벨벳, 트와이스, 마마무, 에이티즈, 더보이즈, RIIZE, PLAVE 등 50+ |
| 발라드 | 먼데이키즈, 임재범, 성시경, 10CM, 아이유, 백예린, 헤이즈, 태연, 멜로망스, 다비치 등 40+ |
| 랩/힙합 | 다이나믹듀오, AOMG, 박재범, 지코, 창모, 이영지, BE'O, 우원재 등 30+ |
| 락/인디 | 밴드, 데이식스, 잔나비, 혁오, 실리카겔, 넬, 버즈, 새소년, 루시 등 30+ |
| 내한공연 | World Tour, Asia Tour, Live in Seoul, in Korea 등 |
| 팬미팅 | 팬미팅, 팬콘, FAN-CON, 쇼케이스, 생일 파티 등 |
| 페스티벌 | 뮤직페스티벌, 워터밤, 펜타포트, 지산, 울트라 등 |
| 트로트 | 미스터트롯, 임영웅, 송가인, 정동원, 장민호, 김호중 등 30+ |
| 기타 | 분류되지 않은 공연 |

## 기술 스택
- **백엔드**: Python Flask
- **프론트엔드**: HTML, CSS, JavaScript (Vanilla)
- **캘린더**: FullCalendar 6.1 (CDN)
- **크롤링**: requests, beautifulsoup4, selenium, webdriver-manager
- **라이브러리**: flask-cors

## 주요 기능

### 구현 완료
- [x] KOPIS API 연동 (콘서트 + 뮤지컬 + 연극)
- [x] 인터파크 JSON 크롤링
- [x] 공연 통합 + 실제 판매처만 표시
- [x] KOPIS 상세 API에서 예매 링크 추출
- [x] 콘서트 세부 장르 자동 분류
- [x] **2개 파트 분류** (콘서트 / 연극&뮤지컬)
- [x] 파트별 탭 필터링
- [x] 소스별 필터링 (KOPIS/인터파크/멜론/YES24)
- [x] 장르별 탭 필터링
- [x] 카드 클릭 시 상세 팝업
- [x] D-day 순 정렬
- [x] **캘린더 뷰** (예매오픈 / 공연일정)
- [x] 캘린더 파트별 필터링
- [x] **홈버튼** (초기화)
- [x] **7개 권역 지역 필터** (서울/경기·인천/강원/충청/전라/경상/제주)
- [x] 지역 뱃지 (카드 + 캘린더)
- [x] 모바일 반응형

### 구현 예정
- [ ] 12시간 자동 업데이트 스케줄러
- [ ] 알림 기능 (티켓오픈 D-day)

## 의사결정 기록

### 2026-01-28 회의 #1~#4
- 콘서트/대중음악만 표시 (연극, 클래식, 뮤지컬 제외)
- 인터파크처럼 세부 장르 분류
- KOPIS API의 relates 태그로 실제 예매 링크 표시
- 캘린더 2종류: 예매오픈일 / 공연일정

### 2026-01-28 회의 #5 (캘린더)
- FullCalendar 라이브러리 사용
- 12시간 업데이트 (00시, 12시)
- 모바일 반응형

### 2026-01-28 회의 #6 (장르/캘린더 개선)
**문제점:**
- 장르가 전부 K-POP/아이돌만 표시됨
- 예매오픈 캘린더에 정보가 없음

**해결책:**
- 장르 키워드 200개 이상으로 대폭 확장
- "기타" 장르도 UI에 표시
- 락/인디, 페스티벌, 기타 탭 추가
- 인터파크 ticketOpenDate 필드 크롤링 추가
- 예매오픈일 없으면 공연 2주 전으로 추정 표시

### 2026-01-28 회의 #7 (Selenium 추가)
**요청:** 멜론티켓/YES24도 크롤링 해달라
**해결:** Selenium 헤드리스 브라우저로 동적 페이지 크롤링 구현
- selenium, webdriver-manager 패키지 추가
- 멜론티켓/YES24 JavaScript 렌더링 후 파싱

### 2026-01-29 v3.0 업그레이드
**요청:**
1. 2개 파트로 분류: 콘서트 / 연극&뮤지컬
2. 캘린더도 파트별 분류
3. 홈버튼 추가
4. 상세 정보 수집 (날짜, 장소, 가격, 출연진)

**해결:**
- KOPIS: 대중음악(CCCD) + 뮤지컬(GGGA) + 연극(AAAA) 모두 조회
- YES24: 콘서트(15457) + 뮤지컬(15458) + 연극(15459) 모두 크롤링
- classify_part() 함수로 공연명/장르 기반 파트 분류
- UI: 파트 탭, 소스 필터 탭, 홈버튼 추가
- 캘린더: 현재 선택된 파트 기준 필터링

## 파일 구조
```
ticket/
├── app.py              # Flask 백엔드 서버 (v3.1 파트+지역 분류 로직)
├── selenium_crawler.py # Selenium 크롤러 (멜론/YES24 다중 장르)
├── templates/
│   └── index.html      # 프론트엔드 (파트탭+소스필터+캘린더)
├── CLAUDE.md           # 프로젝트 문서 (이 파일)
└── .gitignore
```

## 실행 방법
```bash
cd ticket
pip install flask flask-cors requests beautifulsoup4
python app.py
# 브라우저에서 http://localhost:5000 접속
```

## 법적 고려사항
- 크롤링: 공개된 정보만 수집
- 상업적 목적 아닌 개인 프로젝트
- 각 사이트 robots.txt 준수

## 연락처
- KOPIS API 문의: 02-2098-2945
- 이메일: kopis@gokams.or.kr
