<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏΩòÏÑúÌä∏ ÌÜµÌï© Ï†ïÎ≥¥</title>
    <!-- FullCalendar -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' integrity="sha384-a+uEN0SA9NPmaoLnc5WsmxDS2SgEiUlzTisgqmWvaOsxzPREhiatn8EIBuY/Zsl2" crossorigin="anonymous" />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js' integrity="sha384-WfE/vOHqht3KDj6FvpwQUf3UxEPUHoGJ3w1yZ8rhpLWnVigt8HjXL2zXqtcfS7mf" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
            position: relative;
        }

        .home-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .home-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 5px 20px rgba(0,212,255,0.4);
        }

        /* Ïñ∏Ïñ¥ ÏÑ†ÌÉù */
        .lang-selector {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .lang-selector select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .lang-selector select option {
            background: #1a1a2e;
            color: #fff;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1.1rem;
        }

        .update-info {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        .search-box {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .search-box h2 {
            margin-bottom: 20px;
            color: #00d4ff;
        }

        .search-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,212,255,0.4);
        }

        /* Î©îÏù∏ ÌååÌä∏ ÌÉ≠ (ÏΩòÏÑúÌä∏ / Ïó∞Í∑π&ÎÆ§ÏßÄÏª¨) */
        .part-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center;
        }

        .part-tab {
            padding: 15px 40px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 30px;
            color: #aaa;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .part-tab:hover {
            border-color: #7c3aed;
            color: #fff;
        }

        .part-tab.active {
            background: linear-gradient(90deg, #7c3aed, #00d4ff);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 5px 20px rgba(124, 58, 237, 0.4);
        }

        /* ÏÜåÏä§ ÌÉ≠ (Ï†ÑÏ≤¥/KOPIS/Ïù∏ÌÑ∞ÌååÌÅ¨ Îì±) */
        .source-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .source-tab {
            padding: 8px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            color: #888;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .source-tab:hover, .source-tab.active {
            background: rgba(255,255,255,0.15);
            color: #fff;
            border-color: #00d4ff;
        }

        /* ÏßÄÏó≠ ÌïÑÌÑ∞ ÌÉ≠ */
        .region-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .region-tab {
            padding: 6px 14px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 20px;
            color: #888;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .region-tab:hover {
            color: #fff;
            border-color: #7c3aed;
        }

        .region-tab.active {
            background: rgba(124, 58, 237, 0.3);
            color: #fff;
            border-color: #7c3aed;
        }

        .region-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:hover, .tab-btn.active {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
            border-color: transparent;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            max-height: 380px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: #00d4ff;
        }

        .card-img {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #2a2a4a, #1a1a3e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-img.no-poster::after {
            content: 'No Image';
            color: #555;
            font-size: 0.9rem;
        }

        .dday-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .category-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            background: rgba(124, 58, 237, 0.9);
            color: #fff;
        }

        /* Î∑∞ Ï†ÑÌôò ÌÉ≠ */
        .view-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .view-tab {
            padding: 12px 30px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 30px;
            color: #888;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .view-tab:hover, .view-tab.active {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
            border-color: transparent;
        }

        /* Î™©Î°ù Î∑∞ */
        .list-view {
            display: block;
        }

        /* Ï∫òÎ¶∞Îçî Ïª®ÌÖåÏù¥ÎÑà */
        .calendar-container {
            display: none;
            margin-top: 20px;
        }

        .calendar-container.active {
            display: block;
        }

        .calendar-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .calendar-tab {
            padding: 10px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-tab:hover, .calendar-tab.active {
            background: #ff6464;
            color: #fff;
            border-color: transparent;
        }

        .calendar-tab.concert-tab.active {
            background: #00cd3c;
        }

        .calendar-wrapper {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* FullCalendar Îã§ÌÅ¨ ÌÖåÎßà */
        .fc {
            --fc-border-color: rgba(255,255,255,0.1);
            --fc-button-bg-color: rgba(255,255,255,0.1);
            --fc-button-border-color: rgba(255,255,255,0.2);
            --fc-button-hover-bg-color: #7c3aed;
            --fc-button-hover-border-color: #7c3aed;
            --fc-button-active-bg-color: #00d4ff;
            --fc-button-active-border-color: #00d4ff;
            --fc-today-bg-color: rgba(124, 58, 237, 0.2);
            --fc-event-bg-color: #ff6464;
            --fc-event-border-color: #ff6464;
            --fc-page-bg-color: transparent;
        }

        .fc .fc-toolbar-title {
            color: #fff;
            font-size: 1.3rem;
        }

        .fc .fc-button {
            color: #fff;
        }

        .fc .fc-col-header-cell-cushion,
        .fc .fc-daygrid-day-number {
            color: #ccc;
        }

        .fc .fc-day-today {
            background: rgba(124, 58, 237, 0.2) !important;
        }

        .fc-event {
            cursor: pointer;
            font-size: 0.75rem;
            padding: 2px 5px;
            border-radius: 4px;
        }

        .fc-event.ticket-open {
            background: #ff6464 !important;
            border-color: #ff6464 !important;
        }

        .fc-event.concert-date {
            background: #00cd3c !important;
            border-color: #00cd3c !important;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .home-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
                left: 10px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            header p {
                font-size: 0.85rem;
            }

            .part-tabs {
                gap: 10px;
            }

            .part-tab {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .source-tabs {
                gap: 5px;
            }

            .source-tab {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .region-tabs {
                gap: 5px;
            }

            .region-tab {
                padding: 5px 10px;
                font-size: 0.75rem;
            }

            .search-box {
                padding: 15px;
            }

            .search-box h2 {
                font-size: 1.1rem;
            }

            .search-form {
                flex-direction: column;
            }

            .form-group {
                width: 100%;
                min-width: unset;
            }

            .btn {
                width: 100%;
                padding: 15px;
            }

            .view-tabs {
                flex-direction: row;
                gap: 5px;
            }

            .view-tab {
                flex: 1;
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 10px;
                -webkit-overflow-scrolling: touch;
            }

            .tab-btn {
                padding: 8px 15px;
                font-size: 0.8rem;
                flex-shrink: 0;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 10px;
            }

            .card {
                max-height: 320px;
            }

            .card-img {
                height: 140px;
            }

            .card-body {
                padding: 10px;
            }

            .card-title {
                font-size: 0.85rem;
            }

            .card-info {
                font-size: 0.75rem;
            }

            .category-badge {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            .dday-badge {
                font-size: 0.7rem;
                padding: 3px 8px;
            }

            .site-badges {
                gap: 4px;
            }

            .site-badge {
                width: 24px;
                height: 24px;
                font-size: 0.7rem;
            }

            .stats-bar {
                gap: 8px;
            }

            .stat-item {
                padding: 8px 12px;
                min-width: 60px;
            }

            .stat-number {
                font-size: 1.2rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }

            .calendar-tabs {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }

            .calendar-tab {
                padding: 8px 15px;
                font-size: 0.85rem;
            }

            .calendar-wrapper {
                padding: 10px;
            }

            .fc .fc-toolbar {
                flex-direction: column;
                gap: 10px;
            }

            .fc .fc-toolbar-title {
                font-size: 1rem;
            }

            .fc .fc-button {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            /* Î™®Îã¨ Î™®Î∞îÏùº */
            .modal {
                margin: 5px;
                max-height: 95vh;
            }

            .modal-poster {
                height: 180px;
            }

            .modal-content {
                padding: 15px;
            }

            .modal-title {
                font-size: 1.1rem;
            }

            .modal-info-item {
                padding: 8px 0;
            }

            .modal-info-label {
                width: 60px;
                font-size: 0.85rem;
            }

            .modal-info-value {
                font-size: 0.85rem;
            }

            .modal-link-btn {
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            footer {
                padding: 20px;
            }

            footer p {
                font-size: 0.75rem;
            }
        }

        /* ÏûëÏùÄ Î™®Î∞îÏùº */
        @media (max-width: 480px) {
            .results-grid {
                grid-template-columns: 1fr;
            }

            .card {
                max-height: none;
            }

            .card-img {
                height: 180px;
            }
        }

        .dday-urgent {
            background: #ff4444;
            color: #fff;
        }

        .dday-soon {
            background: #ffaa00;
            color: #000;
        }

        .dday-normal {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }

        .card-body {
            padding: 15px;
            overflow: hidden;
        }

        .card-title {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #fff;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            max-height: 2.8em;
        }

        .card-info {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .card-info span {
            color: #00d4ff;
        }

        .card-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            margin-top: 10px;
        }

        .site-badges {
            display: flex;
            gap: 6px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .site-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: default;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #888;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner-lg {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #00d4ff;
            border-right-color: #7c3aed;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 25px;
        }

        .loading-container h3 {
            color: #fff;
            margin-bottom: 30px;
            font-size: 1.2rem;
        }

        .loading-steps {
            display: inline-flex;
            flex-direction: column;
            gap: 12px;
            text-align: left;
            margin-bottom: 30px;
        }

        .loading-step-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .loading-step-item.active {
            color: #00d4ff;
        }

        .loading-step-item.done {
            color: #00cd3c;
        }

        .loading-tip {
            color: #888;
            font-size: 0.9rem;
            margin-top: 10px;
            animation: pulse 2s ease-in-out infinite;
        }

        .bg-loading-bar {
            text-align: center;
            padding: 10px 20px;
            color: #888;
            font-size: 0.85rem;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #888;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 12px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 100px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
        }

        .source-section {
            margin-bottom: 40px;
        }

        .source-section h3 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .source-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        .modal-overlay.active {
            display: flex;
        }

        /* iOS ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
        .modal-link-btn {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .modal {
            background: linear-gradient(135deg, #1e1e3f, #2a2a5a);
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            -webkit-overflow-scrolling: touch;
        }

        /* iOS body Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ */
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 2px solid #fff;
            color: #fff;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #ff4444;
            border-color: #ff4444;
            transform: scale(1.1);
        }

        .modal-poster {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #2a2a4a, #1a1a3e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
        }

        .modal-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-content {
            padding: 25px;
        }

        .modal-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .modal-dday {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .modal-info {
            margin-bottom: 25px;
        }

        .modal-info-item {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .modal-info-label {
            width: 80px;
            color: #888;
            flex-shrink: 0;
        }

        .modal-info-value {
            color: #fff;
            flex: 1;
        }

        .modal-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .modal-link-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border-radius: 10px;
            text-decoration: none;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .modal-link-btn:hover {
            transform: translateY(-2px);
        }

        .link-interpark {
            background: #ff6464;
            color: #fff;
        }

        .link-melon {
            background: #00cd3c;
            color: #fff;
        }

        .link-yes24 {
            background: #ffc800;
            color: #000;
        }

        .link-kopis {
            background: #00d4ff;
            color: #000;
        }

        /* Ï∞ú(ÌïòÌä∏) Î≤ÑÌäº */
        .fav-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0,0,0,0.6);
            border: 2px solid rgba(255,255,255,0.3);
            color: #aaa;
            font-size: 1.1rem;
            cursor: pointer;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .fav-btn:hover {
            transform: scale(1.15);
            border-color: #ff4081;
        }

        .fav-btn.active {
            background: rgba(255, 64, 129, 0.9);
            border-color: #ff4081;
            color: #fff;
        }

        /* Î™®Îã¨ Ï∞ú Î≤ÑÌäº */
        .modal-fav-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #aaa;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
            vertical-align: middle;
        }

        .modal-fav-btn.active {
            background: rgba(255, 64, 129, 0.2);
            border-color: #ff4081;
            color: #ff4081;
        }

        /* ÏïåÎ¶º Î∞î */
        .noti-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 12px 20px;
            margin-bottom: 20px;
        }

        .noti-bar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .noti-bar-label {
            color: #ccc;
            font-size: 0.9rem;
        }

        /* ÌÜ†Í∏Ä Ïä§ÏúÑÏπò */
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            cursor: pointer;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.15);
            border-radius: 13px;
            transition: 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: #fff;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: #ff4081;
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(22px);
        }

        /* Í¥ÄÏã¨ Í≥µÏó∞ Î∞∞ÏßÄ */
        .fav-count-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(255, 64, 129, 0.15);
            border: 1px solid rgba(255, 64, 129, 0.3);
            color: #ff4081;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fav-count-badge:hover {
            background: rgba(255, 64, 129, 0.25);
        }

        .fav-count-badge.filter-active {
            background: #ff4081;
            color: #fff;
            border-color: #ff4081;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï Ï∂îÍ∞Ä */
        @media (max-width: 768px) {
            .fav-btn {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }

            .noti-bar {
                padding: 10px 14px;
                gap: 8px;
            }

            .noti-bar-label {
                font-size: 0.8rem;
            }

            .fav-count-badge {
                font-size: 0.75rem;
                padding: 4px 10px;
            }
        }

        footer {
            text-align: center;
            padding: 40px;
            color: #555;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 50px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .search-form {
                flex-direction: column;
            }

            .form-group {
                width: 100%;
            }

            .modal {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="home-btn" onclick="goHome()" title="ÌôàÏúºÎ°ú">üè†</button>
            <div class="lang-selector">
                <select id="langSelect" onchange="changeLanguage(this.value)">
                    <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                    <option value="en">üá∫üá∏ English</option>
                    <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                    <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                    <option value="es">üá™üá∏ Espa√±ol</option>
                </select>
            </div>
            <h1 data-i18n="title">Í≥µÏó∞ ÌÜµÌï© Ï†ïÎ≥¥</h1>
            <p data-i18n="subtitle">ÏΩòÏÑúÌä∏ ¬∑ ÎÆ§ÏßÄÏª¨ ¬∑ Ïó∞Í∑π ¬∑ K-POP ¬∑ ÎÇ¥ÌïúÍ≥µÏó∞</p>
            <div class="update-info" id="updateInfo" data-i18n="lastUpdate">ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: -</div>
        </header>

        <div class="search-box">
            <h2 data-i18n="search">Í≥µÏó∞ Í≤ÄÏÉâ</h2>
            <div class="search-form">
                <div class="form-group">
                    <label data-i18n="keyword">Í≤ÄÏÉâÏñ¥</label>
                    <input type="text" id="keyword" data-i18n-placeholder="keywordPlaceholder" placeholder="ÏïÑÌã∞Ïä§Ìä∏, Í≥µÏó∞Î™Ö ÏûÖÎ†•...">
                </div>
                <div class="form-group">
                    <label data-i18n="startDate">ÏãúÏûëÏùº</label>
                    <input type="date" id="startDate">
                </div>
                <div class="form-group">
                    <label data-i18n="endDate">Ï¢ÖÎ£åÏùº</label>
                    <input type="date" id="endDate">
                </div>
                <button class="btn btn-primary" onclick="loadAllData()" data-i18n="searchBtn">Í≤ÄÏÉâ</button>
            </div>
        </div>

        <!-- Î∑∞ Ï†ÑÌôò: Î™©Î°ù / Ï∫òÎ¶∞Îçî -->
        <div class="view-tabs">
            <button class="view-tab active" onclick="switchView('list', this)" data-i18n="listView">üìã Î™©Î°ù Î≥¥Í∏∞</button>
            <button class="view-tab" onclick="switchView('calendar', this)" data-i18n="calendarView">üìÖ Ï∫òÎ¶∞Îçî Î≥¥Í∏∞</button>
        </div>

        <!-- ÏïåÎ¶º Î∞î -->
        <div class="noti-bar" id="notiBar">
            <div class="noti-bar-left">
                <span class="noti-bar-label">ÏïåÎ¶º</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="notiToggle" onchange="toggleNotification(this.checked)">
                    <span class="toggle-slider"></span>
                </label>
                <span class="noti-bar-label" id="notiStatus" style="color: #666; font-size: 0.8rem;">ÎπÑÌôúÏÑ±</span>
            </div>
            <div class="fav-count-badge" id="favCountBadge" onclick="toggleFavFilter()">
                ‚ô• Í¥ÄÏã¨ <span id="favCount">0</span>Í±¥
            </div>
        </div>

        <!-- Î™©Î°ù Î∑∞ -->
        <div id="listView" class="list-view">
            <!-- Î©îÏù∏ ÌååÌä∏ ÌÉ≠ -->
            <div class="part-tabs">
                <button class="part-tab active" onclick="switchPart('concert', this)" data-i18n="concert">üé§ ÏΩòÏÑúÌä∏</button>
                <button class="part-tab" onclick="switchPart('theater', this)" data-i18n="theater">üé≠ Ïó∞Í∑π & ÎÆ§ÏßÄÏª¨</button>
            </div>

            <!-- ÏÜåÏä§ ÌïÑÌÑ∞ ÌÉ≠ -->
            <div class="source-tabs">
                <button class="source-tab active" onclick="filterSource('all', this)" data-i18n="all">Ï†ÑÏ≤¥</button>
                <button class="source-tab" onclick="filterSource('KOPIS', this)" style="border-color: #00d4ff;">KOPIS</button>
                <button class="source-tab" onclick="filterSource('Ïù∏ÌÑ∞ÌååÌÅ¨', this)" style="border-color: #ff6464;" data-i18n="interpark">Ïù∏ÌÑ∞ÌååÌÅ¨</button>
                <button class="source-tab" onclick="filterSource('Î©úÎ°†Ìã∞Ïºì', this)" style="border-color: #00cd3c;" data-i18n="melon">Î©úÎ°†</button>
                <button class="source-tab" onclick="filterSource('YES24', this)" style="border-color: #ffc800;">YES24</button>
            </div>

            <!-- ÏßÄÏó≠ ÌïÑÌÑ∞ ÌÉ≠ -->
            <div class="region-tabs" id="regionTabs">
                <button class="region-tab active" onclick="filterRegion('all', this)" data-i18n="all">Ï†ÑÏ≤¥</button>
                <button class="region-tab" onclick="filterRegion('ÏÑúÏö∏', this)" data-i18n="seoul">ÏÑúÏö∏</button>
                <button class="region-tab" onclick="filterRegion('Í≤ΩÍ∏∞¬∑Ïù∏Ï≤ú', this)" data-i18n="gyeonggi">Í≤ΩÍ∏∞¬∑Ïù∏Ï≤ú</button>
                <button class="region-tab" onclick="filterRegion('Í∞ïÏõê', this)" data-i18n="gangwon">Í∞ïÏõê</button>
                <button class="region-tab" onclick="filterRegion('Ï∂©Ï≤≠', this)" data-i18n="chungcheong">Ï∂©Ï≤≠</button>
                <button class="region-tab" onclick="filterRegion('Ï†ÑÎùº', this)" data-i18n="jeolla">Ï†ÑÎùº</button>
                <button class="region-tab" onclick="filterRegion('Í≤ΩÏÉÅ', this)" data-i18n="gyeongsang">Í≤ΩÏÉÅ</button>
                <button class="region-tab" onclick="filterRegion('Ï†úÏ£º', this)" data-i18n="jeju">Ï†úÏ£º</button>
                <button class="region-tab" onclick="filterRegion('ÎØ∏Î∂ÑÎ•ò', this)" data-i18n="unclassified">ÎØ∏Î∂ÑÎ•ò</button>
            </div>

            <!-- ÏΩòÏÑúÌä∏ ÏÑ∏Î∂Ä Ïû•Î•¥ ÌÉ≠ (ÏΩòÏÑúÌä∏ ÌååÌä∏ÏóêÏÑúÎßå ÌëúÏãú) -->
            <div class="tabs" id="genreTabs">
                <button class="tab-btn active" onclick="showTab('all', this)">üî• <span data-i18n="genreAll">Ï†ÑÏ≤¥</span></button>
                <button class="tab-btn" onclick="showTab('ÏïÑÏù¥Îèå', this)">üíú <span data-i18n="genreIdol">ÏïÑÏù¥Îèå/K-POP</span></button>
                <button class="tab-btn" onclick="showTab('Î∞úÎùºÎìú', this)">üé§ <span data-i18n="genreBallad">Î∞úÎùºÎìú</span></button>
                <button class="tab-btn" onclick="showTab('Ìä∏Î°úÌä∏', this)">üì∫ <span data-i18n="genreTrot">Ìä∏Î°úÌä∏</span></button>
                <button class="tab-btn" onclick="showTab('Îû©/ÌûôÌï©', this)">üéß <span data-i18n="genreHiphop">Îû©/ÌûôÌï©</span></button>
                <button class="tab-btn" onclick="showTab('ÎùΩ/Ïù∏Îîî', this)">üé∏ <span data-i18n="genreRock">ÎùΩ/Ïù∏Îîî</span></button>
                <button class="tab-btn" onclick="showTab('ÎÇ¥ÌïúÍ≥µÏó∞', this)">üåç <span data-i18n="genreWorldtour">ÎÇ¥ÌïúÍ≥µÏó∞</span></button>
                <button class="tab-btn" onclick="showTab('Ìå¨ÎØ∏ÌåÖ', this)">üë• <span data-i18n="genreFanmeeting">Ìå¨ÎØ∏ÌåÖ</span></button>
                <button class="tab-btn" onclick="showTab('ÌéòÏä§Ìã∞Î≤å', this)">üé™ <span data-i18n="genreFestival">ÌéòÏä§Ìã∞Î≤å</span></button>
                <button class="tab-btn" onclick="showTab('Í∏∞ÌÉÄ', this)">üìå <span data-i18n="genreEtc">Í∏∞ÌÉÄ</span></button>
            </div>

        <div class="stats-bar" id="statsBar">
            <div class="stat-item">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">Ï†ÑÏ≤¥</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="kopisCount">0</div>
                <div class="stat-label">KOPIS</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="interparkCount">0</div>
                <div class="stat-label">Ïù∏ÌÑ∞ÌååÌÅ¨</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="melonCount">0</div>
                <div class="stat-label">Î©úÎ°†</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="yes24Count">0</div>
                <div class="stat-label">YES24</div>
            </div>
        </div>

            <div id="results">
                <div class="empty-state">
                    <h3>Í≥µÏó∞ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏÑ∏Ïöî</h3>
                    <p>Í≤ÄÏÉâ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ Í≥µÏó∞ Ï†ïÎ≥¥Î•º Ï°∞ÌöåÌï©ÎãàÎã§.</p>
                    <br>
                    <button class="btn btn-primary" onclick="loadAllData()">Ï†ÑÏ≤¥ Í≥µÏó∞ Î∂àÎü¨Ïò§Í∏∞</button>
                </div>
            </div>
        </div><!-- /listView -->

        <!-- Ï∫òÎ¶∞Îçî Î∑∞ -->
        <div id="calendarView" class="calendar-container">
            <div class="calendar-tabs">
                <button class="calendar-tab active" onclick="switchCalendar('ticket', this)">üé´ ÏòàÎß§Ïò§Ìîà Ï∫òÎ¶∞Îçî</button>
                <button class="calendar-tab concert-tab" onclick="switchCalendar('concert', this)">üé§ Í≥µÏó∞ÏùºÏ†ï Ï∫òÎ¶∞Îçî</button>
            </div>
            <div class="calendar-wrapper">
                <div id="calendar"></div>
            </div>
            <div style="margin-top: 15px; text-align: center; color: #888; font-size: 0.85rem;">
                <span style="display: inline-block; width: 12px; height: 12px; background: #ff6464; border-radius: 3px; margin-right: 5px;"></span> ÏòàÎß§Ïò§ÌîàÏùº
                <span style="margin-left: 20px; display: inline-block; width: 12px; height: 12px; background: #00cd3c; border-radius: 3px; margin-right: 5px;"></span> Í≥µÏó∞Ïùº
            </div>
        </div>
    </div>

    <!-- ÏÉÅÏÑ∏ ÌåùÏóÖ Î™®Îã¨ -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div class="modal-poster" id="modalPoster">
                <span>No Image</span>
            </div>
            <div class="modal-content">
                <h2 class="modal-title" id="modalTitle">Í≥µÏó∞Î™Ö</h2>
                <div class="modal-dday dday-normal" id="modalDday">D-day</div>
                <div class="modal-info">
                    <div class="modal-info-item">
                        <span class="modal-info-label" data-i18n="date">Í≥µÏó∞Ïùº</span>
                        <span class="modal-info-value" id="modalDate">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label" data-i18n="venue">Ïû•ÏÜå</span>
                        <span class="modal-info-value" id="modalVenue">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label" data-i18n="genre">Ïû•Î•¥</span>
                        <span class="modal-info-value" id="modalGenre">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label" data-i18n="ticketOpen">Ìã∞ÏºìÏò§Ìîà</span>
                        <span class="modal-info-value" id="modalTicketOpen">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label" data-i18n="price">Í∞ÄÍ≤©</span>
                        <span class="modal-info-value" id="modalPrice">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label" data-i18n="cast">Ï∂úÏó∞</span>
                        <span class="modal-info-value" id="modalCast">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label" data-i18n="status">ÏÉÅÌÉú</span>
                        <span class="modal-info-value" id="modalState">-</span>
                    </div>
                </div>
                <div class="modal-links" id="modalLinks">
                    <!-- ÏòàÎß§ ÎßÅÌÅ¨ Î≤ÑÌäºÎì§ -->
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Í≥µÏó∞ ÌÜµÌï© Ï†ïÎ≥¥ ÏãúÏä§ÌÖú v3.3</p>
        <p style="margin-top: 10px; font-size: 0.85rem;">Îç∞Ïù¥ÌÑ∞ Ï∂úÏ≤ò: KOPIS(Í≥µÏó∞ÏòàÏà†ÌÜµÌï©Ï†ÑÏÇ∞Îßù), Ïù∏ÌÑ∞ÌååÌÅ¨, Î©úÎ°†Ìã∞Ïºì, YES24</p>
        <p style="margin-top: 5px; font-size: 0.8rem; color: #555;">ÏΩòÏÑúÌä∏ / Ïó∞Í∑π & ÎÆ§ÏßÄÏª¨ ÌååÌä∏ Î∂ÑÎ•ò ¬∑ 7Í∞ú Í∂åÏó≠ ÏßÄÏó≠ ÌïÑÌÑ∞ ¬∑ 12ÏãúÍ∞Ñ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ ¬∑ Ï∞ú/ÏïåÎ¶º</p>
    </footer>

    <script>
        // =============================================
        // Î≥¥Ïïà Ïú†Ìã∏Î¶¨Ìã∞
        // =============================================
        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(String(str)));
            return div.innerHTML;
        }

        function sanitizeUrl(url) {
            if (!url) return '';
            const trimmed = url.trim().toLowerCase();
            if (trimmed.startsWith('javascript:') || trimmed.startsWith('data:') || trimmed.startsWith('vbscript:')) {
                return '';
            }
            return url;
        }

        // =============================================
        // Îã§Íµ≠Ïñ¥ ÏßÄÏõê (i18n)
        // =============================================
        // PO ÌååÏùº Í∏∞Î∞ò Î≤àÏó≠ ÏãúÏä§ÌÖú
        let i18nData = {};
        let currentLang = localStorage.getItem('ticket_lang') || 'ko';

        async function loadTranslations(lang) {
            try {
                const response = await fetch(`/api/i18n/${lang}`);
                if (response.ok) {
                    i18nData[lang] = await response.json();
                }
            } catch (e) {
                console.error(`[i18n] ${lang} Î≤àÏó≠ Î°úÎìú Ïã§Ìå®:`, e);
            }
        }

        async function initI18n() {
            await loadTranslations('ko');
            if (currentLang !== 'ko') {
                await loadTranslations(currentLang);
            }
            applyLanguage();
        }

        async function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('ticket_lang', lang);
            if (!i18nData[lang]) {
                await loadTranslations(lang);
            }
            applyLanguage();
            if (allData && allData.length > 0) {
                renderResults();
            }
        }

        function applyLanguage() {
            const texts = i18nData[currentLang] || i18nData['ko'] || {};
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (texts[key]) {
                    el.textContent = texts[key];
                }
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (texts[key]) {
                    el.placeholder = texts[key];
                }
            });
            document.getElementById('langSelect').value = currentLang;
            document.title = texts.title || 'Í≥µÏó∞ ÌÜµÌï© Ï†ïÎ≥¥';
        }

        function t(key) {
            if (i18nData[currentLang] && i18nData[currentLang][key] !== undefined) return i18nData[currentLang][key];
            if (i18nData['ko'] && i18nData['ko'][key] !== undefined) return i18nData['ko'][key];
            return key;
        }

        // ÏÇ¨Ï†Ñ Î≤àÏó≠Îêú Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Î≤àÏó≠ ÌÖçÏä§Ìä∏ Î∞òÌôò
        function getTranslatedText(item, field) {
            if (currentLang === 'ko') return item[field] || '';
            return item[`${field}_${currentLang}`] || item[field] || '';
        }

        // ÏßÄÏó≠Î™Ö ‚Üí i18n ÌÇ§ Îß§Ìïë
        function getRegionI18nKey(region) {
            const map = {
                'ÏÑúÏö∏': 'seoul', 'Í≤ΩÍ∏∞¬∑Ïù∏Ï≤ú': 'gyeonggi', 'Í∞ïÏõê': 'gangwon',
                'Ï∂©Ï≤≠': 'chungcheong', 'Ï†ÑÎùº': 'jeolla', 'Í≤ΩÏÉÅ': 'gyeongsang', 'Ï†úÏ£º': 'jeju',
                'ÎØ∏Î∂ÑÎ•ò': 'unclassified'
            };
            return map[region] || region;
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö ‚Üí i18n ÌÇ§ Îß§Ìïë
        function getCategoryI18nKey(category) {
            const map = {
                'ÏïÑÏù¥Îèå': 'idol', 'Î∞úÎùºÎìú': 'ballad', 'Îû©/ÌûôÌï©': 'hiphop',
                'ÎùΩ/Ïù∏Îîî': 'rock', 'ÎÇ¥ÌïúÍ≥µÏó∞': 'worldtour', 'Ìå¨ÎØ∏ÌåÖ': 'fanmeeting',
                'ÌéòÏä§Ìã∞Î≤å': 'festival', 'Ìä∏Î°úÌä∏': 'trot', 'Í∏∞ÌÉÄ': 'etc'
            };
            return map[category] || category;
        }

        // ÌòÑÏû¨ ÎÇ†Ïßú ÏÑ§Ï†ï
        const today = new Date();
        const sixtyDaysLater = new Date(today.getTime() + 60 * 24 * 60 * 60 * 1000);

        document.getElementById('startDate').value = today.toISOString().split('T')[0];
        document.getElementById('endDate').value = sixtyDaysLater.toISOString().split('T')[0];

        let allData = [];  // ÌÜµÌï©Îêú Í≥µÏó∞ Î¶¨Ïä§Ìä∏
        let allDataMap = {};  // hash -> item Îß§Ìïë
        let currentFilter = 'all';  // Ïû•Î•¥ ÌïÑÌÑ∞
        let currentPart = 'concert';  // ÌååÌä∏ ÌïÑÌÑ∞: concert / theater
        let currentSource = 'all';  // ÏÜåÏä§ ÌïÑÌÑ∞: all / KOPIS / Ïù∏ÌÑ∞ÌååÌÅ¨ / Î©úÎ°†Ìã∞Ïºì / YES24
        let currentRegion = 'all';  // ÏßÄÏó≠ ÌïÑÌÑ∞: all / ÏÑúÏö∏ / Í≤ΩÍ∏∞¬∑Ïù∏Ï≤ú / Í∞ïÏõê / Ï∂©Ï≤≠ / Ï†ÑÎùº / Í≤ΩÏÉÅ / Ï†úÏ£º
        let currentView = 'list';  // ÌòÑÏû¨ Î∑∞: list, calendar
        let currentCalendarType = 'ticket';  // Ï∫òÎ¶∞Îçî ÌÉÄÏûÖ: ticket, concert
        let calendar = null;  // FullCalendar Ïù∏Ïä§ÌÑ¥Ïä§
        let favFilterActive = false;  // Í¥ÄÏã¨ Í≥µÏó∞Îßå Î≥¥Í∏∞ ÌïÑÌÑ∞

        // ÌôàÏúºÎ°ú Ïù¥Îèô (Ï¥àÍ∏∞Ìôî)
        function goHome() {
            currentPart = 'concert';
            currentSource = 'all';
            currentFilter = 'all';
            document.querySelectorAll('.part-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.part-tab').classList.add('active');
            document.querySelectorAll('.source-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.source-tab').classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.tab-btn').classList.add('active');
            currentRegion = 'all';
            document.querySelectorAll('.region-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.region-tab').classList.add('active');
            document.getElementById('keyword').value = '';
            document.getElementById('genreTabs').style.display = 'flex';
            loadAllData();
        }

        // ÌååÌä∏ Ï†ÑÌôò (ÏΩòÏÑúÌä∏ / Ïó∞Í∑π&ÎÆ§ÏßÄÏª¨)
        function switchPart(part, btn) {
            currentPart = part;
            currentFilter = 'all';  // Ïû•Î•¥ ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.part-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            // Ïû•Î•¥ ÌÉ≠ÏùÄ ÏΩòÏÑúÌä∏ ÌååÌä∏ÏóêÏÑúÎßå ÌëúÏãú
            const genreTabs = document.getElementById('genreTabs');
            if (part === 'concert') {
                genreTabs.style.display = 'flex';
            } else {
                genreTabs.style.display = 'none';
            }

            // Ïû•Î•¥ ÌÉ≠ Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.tab-btn').classList.add('active');

            renderResults();
            // Ï∫òÎ¶∞Îçî ÏóÖÎç∞Ïù¥Ìä∏
            if (currentView === 'calendar' && calendar) {
                updateCalendarEvents();
            }
        }

        // ÏÜåÏä§ ÌïÑÌÑ∞
        function filterSource(source, btn) {
            currentSource = source;
            document.querySelectorAll('.source-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
        }

        // ÏßÄÏó≠ ÌïÑÌÑ∞
        function filterRegion(region, btn) {
            currentRegion = region;
            document.querySelectorAll('.region-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
            if (currentView === 'calendar' && calendar) {
                updateCalendarEvents();
            }
        }

        // Î∑∞ Ï†ÑÌôò (Î™©Î°ù / Ï∫òÎ¶∞Îçî)
        function switchView(view, btn) {
            currentView = view;
            document.querySelectorAll('.view-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            if (view === 'list') {
                document.getElementById('listView').style.display = 'block';
                document.getElementById('calendarView').classList.remove('active');
            } else {
                document.getElementById('listView').style.display = 'none';
                document.getElementById('calendarView').classList.add('active');
                initCalendar();
            }
        }

        // Ï∫òÎ¶∞Îçî ÌÉÄÏûÖ Ï†ÑÌôò (ÏòàÎß§Ïò§Ìîà / Í≥µÏó∞ÏùºÏ†ï)
        function switchCalendar(type, btn) {
            currentCalendarType = type;
            document.querySelectorAll('.calendar-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            updateCalendarEvents();
        }

        // Ï∫òÎ¶∞Îçî Ï¥àÍ∏∞Ìôî
        function initCalendar() {
            if (calendar) {
                updateCalendarEvents();
                return;
            }

            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,listMonth'
                },
                buttonText: {
                    today: 'Ïò§Îäò',
                    month: 'ÏõîÍ∞Ñ',
                    list: 'Î™©Î°ù'
                },
                height: 'auto',
                eventClick: function(info) {
                    const item = info.event.extendedProps.item;
                    if (item) showDetail(item);
                },
                eventDidMount: function(info) {
                    // Ìà¥ÌåÅ Ï∂îÍ∞Ä
                    info.el.title = info.event.title;
                }
            });
            calendar.render();
            updateCalendarEvents();
        }

        // Ï∫òÎ¶∞Îçî Ïù¥Î≤§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCalendarEvents() {
            if (!calendar) return;

            // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ ÏÇ≠Ï†ú
            calendar.removeAllEvents();

            // ÌååÌä∏ + ÏßÄÏó≠ ÌïÑÌÑ∞ Ï†ÅÏö©
            let filteredData = allData.filter(item => {
                const itemPart = item.part || 'concert';
                if (itemPart !== currentPart) return false;
                if (currentRegion !== 'all' && item.region !== currentRegion) return false;
                return true;
            });

            // ÏÉà Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            const events = [];
            filteredData.forEach(item => {
                if (currentCalendarType === 'ticket') {
                    // ÏòàÎß§Ïò§Ìîà Ï∫òÎ¶∞Îçî - ticket_open ÎÇ†Ïßú ÏÇ¨Ïö©
                    if (item.ticket_open) {
                        const dateMatch = item.ticket_open.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                        if (dateMatch) {
                            events.push({
                                title: getTranslatedText(item, 'name').substring(0, 20) + (getTranslatedText(item, 'name').length > 20 ? '...' : ''),
                                start: `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`,
                                className: 'ticket-open',
                                extendedProps: { item: item }
                            });
                        }
                    }
                } else {
                    // Í≥µÏó∞ÏùºÏ†ï Ï∫òÎ¶∞Îçî - start_date ÎòêÎäî date ÏÇ¨Ïö©
                    let dateStr = item.start_date || item.date || '';
                    const dateMatch = dateStr.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (dateMatch) {
                        let endDate = null;
                        if (item.end_date) {
                            const endMatch = item.end_date.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                            if (endMatch) {
                                // Ï¢ÖÎ£åÏùº +1Ïùº (FullCalendarÎäî Ï¢ÖÎ£åÏùº ÎØ∏Ìè¨Ìï®)
                                const ed = new Date(`${endMatch[1]}-${endMatch[2]}-${endMatch[3]}`);
                                ed.setDate(ed.getDate() + 1);
                                endDate = ed.toISOString().split('T')[0];
                            }
                        }
                        events.push({
                            title: item.name.substring(0, 20) + (item.name.length > 20 ? '...' : ''),
                            start: `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`,
                            end: endDate,
                            className: 'concert-date',
                            extendedProps: { item: item }
                        });
                    }
                }
            });

            calendar.addEventSource(events);
        }

        // ÌÉ≠ Ï†ÑÌôò (ÏÑ∏Î∂Ä Ïû•Î•¥ ÌïÑÌÑ∞)
        function showTab(filter, btn) {
            currentFilter = filter;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
        }

        // Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (2Îã®Í≥Ñ: Îπ†Î•∏ Î°úÎî© ‚Üí Î∞±Í∑∏ÎùºÏö¥Îìú Ï∂îÍ∞Ä)
        async function loadAllData() {
            const resultsDiv = document.getElementById('results');
            const startDate = document.getElementById('startDate').value.replace(/-/g, '');
            const endDate = document.getElementById('endDate').value.replace(/-/g, '');

            // Î°úÎî© UI ÌëúÏãú
            const tips = [
                'KOPIS Í≥µÏó∞ÏòàÏà†ÌÜµÌï©Ï†ÑÏÇ∞ÎßùÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Í≥† ÏûàÏäµÎãàÎã§...',
                'Ïù∏ÌÑ∞ÌååÌÅ¨ Ìã∞Ïºì Ï†ïÎ≥¥Î•º Ï°∞Ìöå Ï§ëÏûÖÎãàÎã§...',
                'Í≥µÏó∞ Ï†ïÎ≥¥Î•º ÏΩòÏÑúÌä∏ / Ïó∞Í∑π&ÎÆ§ÏßÄÏª¨Î°ú Î∂ÑÎ•òÌïòÍ≥† ÏûàÏäµÎãàÎã§...',
                'ÏÑúÏö∏, Í≤ΩÍ∏∞, Í∞ïÏõê Îì± 7Í∞ú Í∂åÏó≠ÏúºÎ°ú ÏßÄÏó≠ÏùÑ Î∂ÑÎ•ò Ï§ë...',
                'Ï§ëÎ≥µ Í≥µÏó∞ÏùÑ Ï†ïÎ¶¨ÌïòÍ≥† ÌåêÎß§Ï≤òÎ•º ÌÜµÌï©ÌïòÍ≥† ÏûàÏäµÎãàÎã§...',
                'Í±∞Ïùò Îã§ ÎêêÏñ¥Ïöî! Ï°∞Í∏àÎßå Îçî Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî...'
            ];

            resultsDiv.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner-lg"></div>
                    <h3>${t('loading')}</h3>
                    <div class="loading-steps">
                        <div class="loading-step-item active" id="stepKopis">‚è≥ KOPIS Í≥µÏó∞ Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ï§ë...</div>
                        <div class="loading-step-item" id="stepInterpark">‚è≥ Ïù∏ÌÑ∞ÌååÌÅ¨ Ìã∞Ïºì Ï°∞Ìöå ÎåÄÍ∏∞</div>
                        <div class="loading-step-item" id="stepMelon">‚è≥ Î©úÎ°†Ìã∞Ïºì ÎåÄÍ∏∞</div>
                        <div class="loading-step-item" id="stepYes24">‚è≥ YES24 ÎåÄÍ∏∞</div>
                    </div>
                    <div class="loading-tip" id="loadingTip">${tips[0]}</div>
                </div>
            `;

            // ÌåÅ Î°úÌÖåÏù¥ÏÖò
            let tipIdx = 0;
            const tipInterval = setInterval(() => {
                tipIdx = (tipIdx + 1) % tips.length;
                const el = document.getElementById('loadingTip');
                if (el) el.textContent = tips[tipIdx];
            }, 3000);

            try {
                // Phase 1: Îπ†Î•∏ Î°úÎî© (KOPIS + Ïù∏ÌÑ∞ÌååÌÅ¨Îßå, Selenium Ï†úÏô∏)
                const fastResponse = await fetch(`/api/all?start_date=${startDate}&end_date=${endDate}&skip_selenium=true`);
                const fastResult = await fastResponse.json();

                clearInterval(tipInterval);

                if (fastResult.success) {
                    allData = fastResult.data;
                    allDataMap = {};
                    allData.forEach(item => {
                        if (item.hash) allDataMap[item.hash] = item;
                    });
                    updateStats(fastResult.stats);
                    document.getElementById('updateInfo').textContent = `${t('lastUpdate')}: ${fastResult.timestamp}`;
                    renderResults();
                    if (currentView === 'calendar' && calendar) {
                        updateCalendarEvents();
                    }

                    // Phase 2: Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú Î©úÎ°†/YES24 Ï∂îÍ∞Ä Î°úÎî©
                    const bgBar = document.createElement('div');
                    bgBar.id = 'bgLoadingBar';
                    bgBar.className = 'bg-loading-bar';
                    bgBar.innerHTML = 'üîÑ Î©úÎ°†Ìã∞Ïºì ¬∑ YES24 Ï∂îÍ∞Ä Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...';
                    resultsDiv.parentNode.insertBefore(bgBar, resultsDiv);

                    fetch(`/api/all?start_date=${startDate}&end_date=${endDate}`)
                        .then(r => r.json())
                        .then(fullResult => {
                            const bar = document.getElementById('bgLoadingBar');
                            if (bar) bar.remove();
                            if (fullResult.success && fullResult.data.length > allData.length) {
                                allData = fullResult.data;
                                allDataMap = {};
                                allData.forEach(item => {
                                    if (item.hash) allDataMap[item.hash] = item;
                                });
                                updateStats(fullResult.stats);
                                renderResults();
                                if (currentView === 'calendar' && calendar) {
                                    updateCalendarEvents();
                                }
                            } else if (bar) {
                                bar.remove();
                            }
                        })
                        .catch(() => {
                            const bar = document.getElementById('bgLoadingBar');
                            if (bar) bar.textContent = '‚ö†Ô∏è Î©úÎ°†¬∑YES24 Ï∂îÍ∞Ä Î°úÎî© Ïã§Ìå® (Selenium ÌïÑÏöî)';
                        });
                } else {
                    resultsDiv.innerHTML = `<div class="empty-state"><h3>Ïò§Î•ò Î∞úÏÉù</h3><p>${escapeHtml(fastResult.error)}</p></div>`;
                }
            } catch (error) {
                clearInterval(tipInterval);
                resultsDiv.innerHTML = `<div class="empty-state"><h3>Ïò§Î•ò Î∞úÏÉù</h3><p>${escapeHtml(error.message)}</p></div>`;
            }
        }

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStats(stats) {
            document.getElementById('totalCount').textContent = stats.total || 0;
            document.getElementById('kopisCount').textContent = stats.kopis || 0;
            document.getElementById('interparkCount').textContent = stats.interpark || 0;
            document.getElementById('melonCount').textContent = stats.melon || 0;
            document.getElementById('yes24Count').textContent = stats.yes24 || 0;
        }

        // D-day Î±ÉÏßÄ ÏÉùÏÑ±
        function getDdayBadge(dday) {
            if (dday === null || dday === undefined) return '';

            let className = 'dday-normal';
            let text = '';

            if (dday < 0) {
                text = 'Ï¢ÖÎ£å';
                className = 'dday-normal';
            } else if (dday === 0) {
                text = 'D-Day';
                className = 'dday-urgent';
            } else if (dday <= 7) {
                text = `D-${dday}`;
                className = 'dday-urgent';
            } else if (dday <= 14) {
                text = `D-${dday}`;
                className = 'dday-soon';
            } else {
                text = `D-${dday}`;
                className = 'dday-normal';
            }

            return `<span class="dday-badge ${className}">${text}</span>`;
        }

        // ÏßÄÏó≠ ÏÉâÏÉÅ Î∞òÌôò
        function getRegionColor(region) {
            const colors = {
                'ÏÑúÏö∏': '#2563EB',
                'Í≤ΩÍ∏∞¬∑Ïù∏Ï≤ú': '#059669',
                'Í∞ïÏõê': '#0891B2',
                'Ï∂©Ï≤≠': '#7C3AED',
                'Ï†ÑÎùº': '#EA580C',
                'Í≤ΩÏÉÅ': '#DC2626',
                'Ï†úÏ£º': '#DB2777',
                'ÎØ∏Î∂ÑÎ•ò': '#888888'
            };
            return colors[region] || '#888';
        }

        // ÌåêÎß§Ï≤ò Î±ÉÏßÄ ÏÉùÏÑ±
        function getSiteBadges(availableSites) {
            if (!availableSites || availableSites.length === 0) return '';

            return availableSites.map(site => {
                const icon = site.name === 'KOPIS' ? 'K' :
                            site.name === 'Ïù∏ÌÑ∞ÌååÌÅ¨' ? 'I' :
                            site.name === 'Î©úÎ°†Ìã∞Ïºì' ? 'M' :
                            site.name === 'YES24' ? 'Y' : '?';
                return `<span class="site-badge" style="background: ${escapeHtml(site.color)}30; color: ${escapeHtml(site.color)}" title="${escapeHtml(site.name)}">${icon}</span>`;
            }).join('');
        }

        // Í≤∞Í≥º Î†åÎçîÎßÅ
        function renderResults() {
            const resultsDiv = document.getElementById('results');
            let html = '';

            // Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞
            const keyword = document.getElementById('keyword').value.trim().toLowerCase();

            // ÌïÑÌÑ∞ Ï†ÅÏö©
            let filteredData = allData;

            // 1. ÌååÌä∏ ÌïÑÌÑ∞ÎßÅ (concert / theater)
            filteredData = filteredData.filter(item => {
                const itemPart = item.part || 'concert';
                return itemPart === currentPart;
            });

            // 2. ÏÜåÏä§ ÌïÑÌÑ∞ÎßÅ
            if (currentSource !== 'all') {
                filteredData = filteredData.filter(item => {
                    if (item.available_sites) {
                        return item.available_sites.some(site => site.name === currentSource);
                    }
                    return item.source === currentSource;
                });
            }

            // 3. ÏßÄÏó≠ ÌïÑÌÑ∞ÎßÅ
            if (currentRegion !== 'all') {
                filteredData = filteredData.filter(item => item.region === currentRegion);
            }

            // 4. Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞ÎßÅ
            if (keyword) {
                filteredData = filteredData.filter(item => {
                    const name = (item.name || '').toLowerCase();
                    const venue = (item.venue || '').toLowerCase();
                    return name.includes(keyword) || venue.includes(keyword);
                });
            }

            // 5. Ïû•Î•¥ ÌïÑÌÑ∞ÎßÅ (ÏΩòÏÑúÌä∏ ÌååÌä∏ÏóêÏÑúÎßå)
            if (currentPart === 'concert' && currentFilter !== 'all') {
                filteredData = filteredData.filter(item => item.category === currentFilter);
            }

            // 6. Í¥ÄÏã¨ Í≥µÏó∞Îßå Î≥¥Í∏∞ ÌïÑÌÑ∞
            if (favFilterActive) {
                const favs = getFavorites();
                filteredData = filteredData.filter(item => item.hash && favs[item.hash]);
            }

            if (filteredData.length > 0) {
                const countText = currentLang === 'ko' || currentLang === 'ja' || currentLang === 'zh' ?
                    `(${filteredData.length}${t('count')})` : `(${filteredData.length})`;
                html += `
                    <div class="source-section">
                        <h3>
                            <span class="source-icon" style="background: #7c3aed30; color: #7c3aed">üé´</span>
                            ${t('performanceList')} ${countText} - ${t('sortByDday')}
                        </h3>
                        <div class="results-grid">
                `;

                filteredData.forEach((item) => {
                    const ddayBadge = getDdayBadge(item.dday);
                    const siteBadges = getSiteBadges(item.available_sites);
                    const categoryBadge = item.category ?
                        `<span class="category-badge">${t(getCategoryI18nKey(item.category))}</span>` : '';

                    // YES24/Î©úÎ°† Ïù¥ÎØ∏ÏßÄÎäî Ï∫êÏã± ÌîÑÎ°ùÏãú ÏÇ¨Ïö©
                    let posterUrl = item.poster || '';
                    if (posterUrl && (posterUrl.includes('yes24.com') || posterUrl.includes('melon.com') || posterUrl.includes('tkfile'))) {
                        posterUrl = '/api/proxy/image?url=' + encodeURIComponent(posterUrl);
                    }

                    const isFav = isFavorite(item.hash);

                    const displayName = getTranslatedText(item, 'name') || t('noTitle');
                    const displayVenue = getTranslatedText(item, 'venue');

                    html += `
                        <div class="card" data-hash="${escapeHtml(item.hash)}">
                            <div class="card-img">
                                ${posterUrl ? `<img src="${escapeHtml(posterUrl)}" alt="${escapeHtml(displayName)}" loading="lazy" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('no-poster');">` : ''}
                                ${ddayBadge}
                                ${categoryBadge}
                                <button class="fav-btn ${isFav ? 'active' : ''}" data-fav-hash="${escapeHtml(item.hash)}" title="${t('addFavorite')}">${isFav ? '‚ô•' : '‚ô°'}</button>
                            </div>
                            <div class="card-body">
                                <div class="card-title">${escapeHtml(displayName)}</div>
                                ${displayVenue ? `<div class="card-info"><span>${t('venue')}</span> ${escapeHtml(displayVenue)}</div>` : ''}
                                ${item.start_date ? `<div class="card-info"><span>${t('period')}</span> ${escapeHtml(item.start_date)} ~ ${escapeHtml(item.end_date || '')}</div>` : ''}
                                ${item.date ? `<div class="card-info"><span>${t('date')}</span> ${escapeHtml(item.date)}</div>` : ''}
                                ${item.ticket_open ? `<div class="card-info"><span>${t('ticketOpen')}</span> ${escapeHtml(item.ticket_open)}</div>` : ''}
                                <div class="site-badges">${siteBadges}</div>
                                ${item.region ? `<span class="region-badge" style="background: ${getRegionColor(item.region)}30; color: ${getRegionColor(item.region)}">${t(getRegionI18nKey(item.region))}</span>` : ''}
                            </div>
                        </div>
                    `;
                });

                html += '</div></div>';
            }

            if (!html) {
                html = `<div class="empty-state"><h3>${t('noResults')}</h3><p>${t('tryOther')}</p></div>`;
            }

            resultsDiv.innerHTML = html;
        }

        // hashÎ°ú ÏÉÅÏÑ∏ ÌåùÏóÖ ÌëúÏãú
        function showDetailByHash(hash) {
            const item = allDataMap[hash];
            if (item) {
                showDetail(item);
            } else {
                console.error('ÏïÑÏù¥ÌÖúÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', hash);
            }
        }

        // ÏÉÅÏÑ∏ ÌåùÏóÖ ÌëúÏãú
        async function showDetail(item) {
            const modal = document.getElementById('modalOverlay');

            // Î≤àÏó≠Îêú ÌÖçÏä§Ìä∏ ÏÇ¨Ïö©
            const displayName = getTranslatedText(item, 'name') || t('noTitle');
            const displayVenue = getTranslatedText(item, 'venue') || '-';

            // Í∏∞Î≥∏ Ï†ïÎ≥¥ ÏÑ§Ï†ï + Ï∞ú Î≤ÑÌäº (DOM APIÎ°ú ÏïàÏ†ÑÌïòÍ≤å Íµ¨ÏÑ±)
            const isFav = isFavorite(item.hash);
            const titleEl = document.getElementById('modalTitle');
            titleEl.textContent = '';
            titleEl.appendChild(document.createTextNode(displayName));
            const modalFavBtn = document.createElement('button');
            modalFavBtn.className = `modal-fav-btn ${isFav ? 'active' : ''}`;
            modalFavBtn.textContent = isFav ? '‚ô• ' + t('removeFavorite') : '‚ô° ' + t('addToFavorite');
            modalFavBtn.addEventListener('click', function() { toggleFavorite(item.hash, this, true); });
            titleEl.appendChild(modalFavBtn);
            document.getElementById('modalVenue').textContent = displayVenue;
            document.getElementById('modalGenre').textContent = item.genre || '-';
            document.getElementById('modalState').textContent = item.state || '-';
            document.getElementById('modalTicketOpen').textContent = item.ticket_open || '-';

            // ÎÇ†Ïßú Ï†ïÎ≥¥
            if (item.start_date) {
                document.getElementById('modalDate').textContent = `${item.start_date} ~ ${item.end_date || ''}`;
            } else if (item.date) {
                document.getElementById('modalDate').textContent = item.date;
            } else {
                document.getElementById('modalDate').textContent = '-';
            }

            // Ìè¨Ïä§ÌÑ∞ (YES24/Î©úÎ°†ÏùÄ Ï∫êÏã± ÌîÑÎ°ùÏãú ÏÇ¨Ïö©)
            const posterDiv = document.getElementById('modalPoster');
            if (item.poster) {
                let modalPosterUrl = item.poster;
                if (modalPosterUrl.includes('yes24.com') || modalPosterUrl.includes('melon.com') || modalPosterUrl.includes('tkfile')) {
                    modalPosterUrl = '/api/proxy/image?url=' + encodeURIComponent(modalPosterUrl);
                }
                posterDiv.innerHTML = `<img src="${escapeHtml(modalPosterUrl)}" alt="${escapeHtml(displayName)}" onerror="this.parentElement.innerHTML='<span>No Image</span>'">`;
            } else {
                posterDiv.innerHTML = '<span>No Image</span>';
            }

            // D-day
            const ddayDiv = document.getElementById('modalDday');
            if (item.dday !== null && item.dday !== undefined) {
                let ddayText = item.dday === 0 ? 'D-Day' : (item.dday > 0 ? `D-${item.dday}` : 'Ï¢ÖÎ£å');
                let ddayClass = item.dday <= 7 ? 'dday-urgent' : (item.dday <= 14 ? 'dday-soon' : 'dday-normal');
                ddayDiv.textContent = ddayText;
                ddayDiv.className = `modal-dday ${ddayClass}`;
                ddayDiv.style.display = 'inline-block';
            } else {
                ddayDiv.style.display = 'none';
            }

            // ÏòàÎß§ ÎßÅÌÅ¨ ÏòÅÏó≠ Ï¥àÍ∏∞Ìôî
            const linksDiv = document.getElementById('modalLinks');
            linksDiv.innerHTML = '<p style="color: #888;">ÏòàÎß§ Ï†ïÎ≥¥ Î°úÎî© Ï§ë...</p>';

            // KOPISÏù∏ Í≤ΩÏö∞ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ + Ïã§Ï†ú ÏòàÎß§ ÎßÅÌÅ¨ Î°úÎìú
            if (item.id) {
                try {
                    const response = await fetch(`/api/kopis/performance/${item.id}`);
                    const result = await response.json();
                    if (result.success) {
                        const detail = result.data;
                        document.getElementById('modalPrice').textContent = detail.price || '-';
                        document.getElementById('modalCast').textContent = detail.cast || '-';
                        if (detail.schedule) {
                            document.getElementById('modalDate').textContent += ` (${detail.schedule})`;
                        }

                        // Ïã§Ï†ú ÏòàÎß§ ÎßÅÌÅ¨ ÌëúÏãú (KOPIS APIÏóêÏÑú Ï†úÍ≥µ)
                        let linksHtml = '';
                        if (detail.booking_sites && detail.booking_sites.length > 0) {
                            detail.booking_sites.forEach(site => {
                                linksHtml += `<a href="${sanitizeUrl(escapeHtml(site.url))}" target="_blank" rel="noopener noreferrer" class="modal-link-btn" style="background: ${escapeHtml(site.color)}; color: #fff;">${escapeHtml(site.name)} ÏòàÎß§</a>`;
                            });
                            linksDiv.innerHTML = linksHtml;
                        } else {
                            linksDiv.innerHTML = '<p style="color: #888;">Îì±Î°ùÎêú ÏòàÎß§Ï≤òÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                        }
                    } else {
                        document.getElementById('modalPrice').textContent = '-';
                        document.getElementById('modalCast').textContent = '-';
                        linksDiv.innerHTML = '<p style="color: #888;">ÏòàÎß§ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                    }
                } catch (e) {
                    console.log('ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:', e);
                    document.getElementById('modalPrice').textContent = '-';
                    document.getElementById('modalCast').textContent = '-';
                    linksDiv.innerHTML = '<p style="color: #888;">ÏòàÎß§ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                }
            } else {
                // KOPIS IDÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ (ÌÅ¨Î°§ÎßÅ Îç∞Ïù¥ÌÑ∞) - Í∏∞Î≥∏ Ï†ïÎ≥¥Îßå ÌëúÏãú
                document.getElementById('modalPrice').textContent = '-';
                document.getElementById('modalCast').textContent = '-';

                // ÏòàÎß§ ÎßÅÌÅ¨ ÌëúÏãú
                let linksHtml = '';
                if (item.available_sites && item.available_sites.length > 0) {
                    item.available_sites.forEach(site => {
                        if (site.link && site.link !== '') {
                            linksHtml += `<a href="${sanitizeUrl(escapeHtml(site.link))}" target="_blank" rel="noopener noreferrer" class="modal-link-btn" style="background: ${escapeHtml(site.color)}; color: #fff;">${escapeHtml(site.name)} ÏòàÎß§</a>`;
                        }
                    });
                }
                linksDiv.innerHTML = linksHtml || '<p style="color: #888;">ÏòàÎß§ ÎßÅÌÅ¨ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
            }

            modal.classList.add('active');
            document.body.classList.add('modal-open');
            document.body.style.overflow = 'hidden';
        }

        // Î™®Îã¨ Îã´Í∏∞
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
        }

        // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // iOS ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ ÏµúÏ†ÅÌôî - Ïπ¥Îìú ÌÅ¥Î¶≠ + Ï∞ú Î≤ÑÌäº (Ïù¥Î≤§Ìä∏ ÏúÑÏûÑ)
        document.getElementById('results').addEventListener('click', function(e) {
            // Ï∞ú Î≤ÑÌäº ÌÅ¥Î¶≠ Ï≤òÎ¶¨
            const favBtn = e.target.closest('.fav-btn');
            if (favBtn) {
                e.stopPropagation();
                const hash = favBtn.dataset.favHash;
                if (hash) toggleFavorite(hash, favBtn);
                return;
            }
            // Ïπ¥Îìú ÌÅ¥Î¶≠ Ï≤òÎ¶¨
            const card = e.target.closest('.card');
            if (card) {
                const hash = card.dataset.hash;
                if (hash) {
                    e.preventDefault();
                    showDetailByHash(hash);
                }
            }
        });

        // iOSÏóêÏÑú Î™®Îã¨ Îã´Í∏∞ ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏
        document.getElementById('modalOverlay').addEventListener('touchend', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Í≤ÄÏÉâÏñ¥ ÏûÖÎ†• Ïãú Ïã§ÏãúÍ∞Ñ ÌïÑÌÑ∞ÎßÅ
        document.getElementById('keyword').addEventListener('input', function(e) {
            if (allData.length > 0) {
                renderResults();
            }
        });

        // Enter ÌÇ§Î°ú Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°ú Î°úÎìú
        document.getElementById('keyword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadAllData();
            }
        });

        // =============================================
        // Í¥ÄÏã¨ Í≥µÏó∞ (Ï∞ú) Í¥ÄÎ¶¨ - LocalStorage
        // =============================================

        function getFavorites() {
            try {
                return JSON.parse(localStorage.getItem('ticket_favorites') || '{}');
            } catch { return {}; }
        }

        function saveFavorites(favs) {
            localStorage.setItem('ticket_favorites', JSON.stringify(favs));
        }

        function isFavorite(hash) {
            if (!hash) return false;
            const favs = getFavorites();
            return !!favs[hash];
        }

        function toggleFavorite(hash, btnEl, isModal) {
            if (!hash) return;
            const favs = getFavorites();
            const item = allDataMap[hash];

            if (favs[hash]) {
                // Ï∞ú Ìï¥Ï†ú
                delete favs[hash];
                if (btnEl) {
                    if (isModal) {
                        btnEl.classList.remove('active');
                        btnEl.innerHTML = '‚ô° Ï∞úÌïòÍ∏∞';
                    } else {
                        btnEl.classList.remove('active');
                        btnEl.textContent = '‚ô°';
                    }
                }
            } else {
                // Ï∞ú Îì±Î°ù
                if (item) {
                    favs[hash] = {
                        name: item.name || '',
                        ticket_open: item.ticket_open || '',
                        dday: item.dday,
                        start_date: item.start_date || '',
                        venue: item.venue || ''
                    };
                }
                if (btnEl) {
                    if (isModal) {
                        btnEl.classList.add('active');
                        btnEl.innerHTML = '‚ô• Ï∞ú Ìï¥Ï†ú';
                    } else {
                        btnEl.classList.add('active');
                        btnEl.textContent = '‚ô•';
                    }
                }
            }

            saveFavorites(favs);
            updateFavCount();

            // Ïπ¥ÎìúÏùò Ï∞ú Î≤ÑÌäº ÏÉÅÌÉúÎèÑ ÎèôÍ∏∞Ìôî
            if (isModal) {
                const cardBtn = document.querySelector(`.fav-btn[data-hash="${hash}"]`);
                if (cardBtn) {
                    if (favs[hash]) {
                        cardBtn.classList.add('active');
                        cardBtn.textContent = '‚ô•';
                    } else {
                        cardBtn.classList.remove('active');
                        cardBtn.textContent = '‚ô°';
                    }
                }
            }
        }

        function updateFavCount() {
            const favs = getFavorites();
            const count = Object.keys(favs).length;
            document.getElementById('favCount').textContent = count;
        }

        function toggleFavFilter() {
            favFilterActive = !favFilterActive;
            const badge = document.getElementById('favCountBadge');
            if (favFilterActive) {
                badge.classList.add('filter-active');
            } else {
                badge.classList.remove('filter-active');
            }
            renderResults();
        }


        // =============================================
        // Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶º (Notification API)
        // =============================================

        let notiCheckInterval = null;

        // Í∏∞Í∏∞ Í∞êÏßÄ: iOS ÎòêÎäî ÎÑ§Ïù¥Î≤ÑÏï±Ïù∏ÏßÄ ÌôïÏù∏
        function isUnsupportedDevice() {
            const ua = navigator.userAgent || '';
            const isIOS = /iPhone|iPad|iPod/i.test(ua);
            const isNaverApp = /NAVER/i.test(ua);
            return isIOS || isNaverApp;
        }

        function toggleNotification(enabled) {
            const statusEl = document.getElementById('notiStatus');

            // iOS/ÎÑ§Ïù¥Î≤ÑÏï±ÏùÄ ÏïåÎ¶º ÎØ∏ÏßÄÏõê
            if (isUnsupportedDevice()) {
                alert('iOS ÎòêÎäî ÎÑ§Ïù¥Î≤Ñ Ïï±ÏóêÏÑúÎäî Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶ºÏù¥ ÏßÄÏõêÎêòÏßÄ ÏïäÏäµÎãàÎã§.\n\nSafariÏóêÏÑú Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞ÄÌïòÍ±∞ÎÇò, Chrome/Samsung Î∏åÎùºÏö∞Ï†ÄÎ•º Ïù¥Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.');
                document.getElementById('notiToggle').checked = false;
                statusEl.textContent = 'ÎØ∏ÏßÄÏõê Í∏∞Í∏∞';
                statusEl.style.color = '#ff4444';
                return;
            }

            if (enabled) {
                // Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠
                if (!('Notification' in window)) {
                    alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏïåÎ¶ºÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                    document.getElementById('notiToggle').checked = false;
                    return;
                }

                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        localStorage.setItem('ticket_noti_enabled', 'true');
                        statusEl.textContent = 'ÌôúÏÑ±';
                        statusEl.style.color = '#ff4081';
                        startNotiCheck();
                    } else {
                        document.getElementById('notiToggle').checked = false;
                        localStorage.setItem('ticket_noti_enabled', 'false');
                        statusEl.textContent = 'Í∂åÌïú Í±∞Î∂ÄÎê®';
                        statusEl.style.color = '#ff4444';
                    }
                });
            } else {
                localStorage.setItem('ticket_noti_enabled', 'false');
                statusEl.textContent = 'ÎπÑÌôúÏÑ±';
                statusEl.style.color = '#666';
                stopNotiCheck();
            }
        }

        function startNotiCheck() {
            // 30Î∂ÑÎßàÎã§ D-day Ï≤¥ÌÅ¨
            if (notiCheckInterval) clearInterval(notiCheckInterval);
            checkFavoriteDdays(); // Ï¶âÏãú 1Ìöå Ï≤¥ÌÅ¨
            notiCheckInterval = setInterval(checkFavoriteDdays, 30 * 60 * 1000);
        }

        function stopNotiCheck() {
            if (notiCheckInterval) {
                clearInterval(notiCheckInterval);
                notiCheckInterval = null;
            }
        }

        function checkFavoriteDdays() {
            if (localStorage.getItem('ticket_noti_enabled') !== 'true') return;
            if (Notification.permission !== 'granted') return;

            const favs = getFavorites();
            const todayKey = new Date().toISOString().split('T')[0].replace(/-/g, '.');
            const notifiedKey = `ticket_notified_${todayKey}`;

            // Ïò§Îäò Ïù¥ÎØ∏ ÏïåÎ¶º Î≥¥ÎÇ∏ Î™©Î°ù
            let notified = {};
            try {
                notified = JSON.parse(localStorage.getItem(notifiedKey) || '{}');
            } catch { notified = {}; }

            for (const [hash, info] of Object.entries(favs)) {
                if (notified[hash]) continue; // ÌïòÎ£® 1Ìöå Ï§ëÎ≥µ Î∞©ÏßÄ

                const dday = info.dday;
                // ticket_openÏù¥ ÏûàÏúºÎ©¥ Ïã§ÏãúÍ∞ÑÏúºÎ°ú D-day Ïû¨Í≥ÑÏÇ∞
                let currentDday = dday;
                if (info.ticket_open) {
                    const match = info.ticket_open.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (match) {
                        const target = new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        currentDday = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
                    }
                }

                // D-1 ÎòêÎäî D-DayÏóêÎßå ÏïåÎ¶º
                if (currentDday === 1 || currentDday === 0) {
                    const title = currentDday === 0 ? 'Ïò§Îäò ÏòàÎß§ Ïò§Ìîà!' : 'ÎÇ¥Ïùº ÏòàÎß§ Ïò§Ìîà!';
                    const body = `${info.name}\n${info.ticket_open || ''} | ${info.venue || ''}`;

                    const notification = new Notification(title, {
                        body: body,
                        icon: 'üé´',
                        tag: hash,
                        requireInteraction: true
                    });

                    notification.onclick = function() {
                        window.focus();
                        // Ìï¥Îãπ Í≥µÏó∞ ÏÉÅÏÑ∏ ÌåùÏóÖ Ïó¥Í∏∞
                        const item = allDataMap[hash];
                        if (item) showDetail(item);
                        notification.close();
                    };

                    // ÏïåÎ¶º Î∞úÏÜ° Í∏∞Î°ù
                    notified[hash] = true;
                    localStorage.setItem(notifiedKey, JSON.stringify(notified));
                }
            }

            // Ïò§ÎûòÎêú ÏïåÎ¶º Í∏∞Î°ù Ï†ïÎ¶¨ (3Ïùº Ïù¥Ï†Ñ Í≤É ÏÇ≠Ï†ú)
            cleanupOldNotifiedRecords();
        }

        function cleanupOldNotifiedRecords() {
            const today = new Date();
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('ticket_notified_')) {
                    const dateStr = key.replace('ticket_notified_', '');
                    try {
                        const parts = dateStr.split('.');
                        const recordDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                        const daysDiff = Math.floor((today - recordDate) / (1000 * 60 * 60 * 24));
                        if (daysDiff > 3) {
                            localStorage.removeItem(key);
                        }
                    } catch {}
                }
            }
        }

        // ÏïåÎ¶º Ï¥àÍ∏∞ ÏÉÅÌÉú Î≥µÏõê
        function initNotification() {
            const toggle = document.getElementById('notiToggle');
            const statusEl = document.getElementById('notiStatus');

            // iOS/ÎÑ§Ïù¥Î≤ÑÏï±ÏùÄ ÏïåÎ¶º UI ÎπÑÌôúÏÑ±Ìôî
            if (isUnsupportedDevice()) {
                toggle.disabled = true;
                statusEl.textContent = 'ÎØ∏ÏßÄÏõê Í∏∞Í∏∞';
                statusEl.style.color = '#888';
                updateFavCount();
                return;
            }

            const enabled = localStorage.getItem('ticket_noti_enabled') === 'true';

            if (enabled && Notification.permission === 'granted') {
                toggle.checked = true;
                statusEl.textContent = 'ÌôúÏÑ±';
                statusEl.style.color = '#ff4081';
                startNotiCheck();
            } else {
                toggle.checked = false;
                localStorage.setItem('ticket_noti_enabled', 'false');
            }

            updateFavCount();
        }


        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏûêÎèô Ï°∞Ìöå
        window.onload = async function() {
            await initI18n();
            initNotification();
            loadAllData();
        };
    </script>
</body>
</html>
