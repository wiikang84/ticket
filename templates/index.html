<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½˜ì„œíŠ¸ í†µí•© ì •ë³´</title>
    <!-- FullCalendar -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
            position: relative;
        }

        .home-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .home-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 5px 20px rgba(0,212,255,0.4);
        }

        /* ì–¸ì–´ ì„ íƒ */
        .lang-selector {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .lang-selector select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .lang-selector select option {
            background: #1a1a2e;
            color: #fff;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1.1rem;
        }

        .update-info {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        .search-box {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .search-box h2 {
            margin-bottom: 20px;
            color: #00d4ff;
        }

        .search-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,212,255,0.4);
        }

        /* ë©”ì¸ íŒŒíŠ¸ íƒ­ (ì½˜ì„œíŠ¸ / ì—°ê·¹&ë®¤ì§€ì»¬) */
        .part-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center;
        }

        .part-tab {
            padding: 15px 40px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 30px;
            color: #aaa;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .part-tab:hover {
            border-color: #7c3aed;
            color: #fff;
        }

        .part-tab.active {
            background: linear-gradient(90deg, #7c3aed, #00d4ff);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 5px 20px rgba(124, 58, 237, 0.4);
        }

        /* ì†ŒìŠ¤ íƒ­ (ì „ì²´/KOPIS/ì¸í„°íŒŒí¬ ë“±) */
        .source-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .source-tab {
            padding: 8px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            color: #888;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .source-tab:hover, .source-tab.active {
            background: rgba(255,255,255,0.15);
            color: #fff;
            border-color: #00d4ff;
        }

        /* ì§€ì—­ í•„í„° íƒ­ */
        .region-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .region-tab {
            padding: 6px 14px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 20px;
            color: #888;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .region-tab:hover {
            color: #fff;
            border-color: #7c3aed;
        }

        .region-tab.active {
            background: rgba(124, 58, 237, 0.3);
            color: #fff;
            border-color: #7c3aed;
        }

        .region-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:hover, .tab-btn.active {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
            border-color: transparent;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            max-height: 380px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: #00d4ff;
        }

        .card-img {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #2a2a4a, #1a1a3e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-img.no-poster::after {
            content: 'No Image';
            color: #555;
            font-size: 0.9rem;
        }

        .dday-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .category-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            background: rgba(124, 58, 237, 0.9);
            color: #fff;
        }

        /* ë·° ì „í™˜ íƒ­ */
        .view-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .view-tab {
            padding: 12px 30px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 30px;
            color: #888;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .view-tab:hover, .view-tab.active {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
            border-color: transparent;
        }

        /* ëª©ë¡ ë·° */
        .list-view {
            display: block;
        }

        /* ìº˜ë¦°ë” ì»¨í…Œì´ë„ˆ */
        .calendar-container {
            display: none;
            margin-top: 20px;
        }

        .calendar-container.active {
            display: block;
        }

        .calendar-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .calendar-tab {
            padding: 10px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-tab:hover, .calendar-tab.active {
            background: #ff6464;
            color: #fff;
            border-color: transparent;
        }

        .calendar-tab.concert-tab.active {
            background: #00cd3c;
        }

        .calendar-wrapper {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* FullCalendar ë‹¤í¬ í…Œë§ˆ */
        .fc {
            --fc-border-color: rgba(255,255,255,0.1);
            --fc-button-bg-color: rgba(255,255,255,0.1);
            --fc-button-border-color: rgba(255,255,255,0.2);
            --fc-button-hover-bg-color: #7c3aed;
            --fc-button-hover-border-color: #7c3aed;
            --fc-button-active-bg-color: #00d4ff;
            --fc-button-active-border-color: #00d4ff;
            --fc-today-bg-color: rgba(124, 58, 237, 0.2);
            --fc-event-bg-color: #ff6464;
            --fc-event-border-color: #ff6464;
            --fc-page-bg-color: transparent;
        }

        .fc .fc-toolbar-title {
            color: #fff;
            font-size: 1.3rem;
        }

        .fc .fc-button {
            color: #fff;
        }

        .fc .fc-col-header-cell-cushion,
        .fc .fc-daygrid-day-number {
            color: #ccc;
        }

        .fc .fc-day-today {
            background: rgba(124, 58, 237, 0.2) !important;
        }

        .fc-event {
            cursor: pointer;
            font-size: 0.75rem;
            padding: 2px 5px;
            border-radius: 4px;
        }

        .fc-event.ticket-open {
            background: #ff6464 !important;
            border-color: #ff6464 !important;
        }

        .fc-event.concert-date {
            background: #00cd3c !important;
            border-color: #00cd3c !important;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .home-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
                left: 10px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            header p {
                font-size: 0.85rem;
            }

            .part-tabs {
                gap: 10px;
            }

            .part-tab {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .source-tabs {
                gap: 5px;
            }

            .source-tab {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .region-tabs {
                gap: 5px;
            }

            .region-tab {
                padding: 5px 10px;
                font-size: 0.75rem;
            }

            .search-box {
                padding: 15px;
            }

            .search-box h2 {
                font-size: 1.1rem;
            }

            .search-form {
                flex-direction: column;
            }

            .form-group {
                width: 100%;
                min-width: unset;
            }

            .btn {
                width: 100%;
                padding: 15px;
            }

            .view-tabs {
                flex-direction: row;
                gap: 5px;
            }

            .view-tab {
                flex: 1;
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 10px;
                -webkit-overflow-scrolling: touch;
            }

            .tab-btn {
                padding: 8px 15px;
                font-size: 0.8rem;
                flex-shrink: 0;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 10px;
            }

            .card {
                max-height: 320px;
            }

            .card-img {
                height: 140px;
            }

            .card-body {
                padding: 10px;
            }

            .card-title {
                font-size: 0.85rem;
            }

            .card-info {
                font-size: 0.75rem;
            }

            .category-badge {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            .dday-badge {
                font-size: 0.7rem;
                padding: 3px 8px;
            }

            .site-badges {
                gap: 4px;
            }

            .site-badge {
                width: 24px;
                height: 24px;
                font-size: 0.7rem;
            }

            .stats-bar {
                gap: 8px;
            }

            .stat-item {
                padding: 8px 12px;
                min-width: 60px;
            }

            .stat-number {
                font-size: 1.2rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }

            .calendar-tabs {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }

            .calendar-tab {
                padding: 8px 15px;
                font-size: 0.85rem;
            }

            .calendar-wrapper {
                padding: 10px;
            }

            .fc .fc-toolbar {
                flex-direction: column;
                gap: 10px;
            }

            .fc .fc-toolbar-title {
                font-size: 1rem;
            }

            .fc .fc-button {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            /* ëª¨ë‹¬ ëª¨ë°”ì¼ */
            .modal {
                margin: 5px;
                max-height: 95vh;
            }

            .modal-poster {
                height: 180px;
            }

            .modal-content {
                padding: 15px;
            }

            .modal-title {
                font-size: 1.1rem;
            }

            .modal-info-item {
                padding: 8px 0;
            }

            .modal-info-label {
                width: 60px;
                font-size: 0.85rem;
            }

            .modal-info-value {
                font-size: 0.85rem;
            }

            .modal-link-btn {
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            footer {
                padding: 20px;
            }

            footer p {
                font-size: 0.75rem;
            }
        }

        /* ì‘ì€ ëª¨ë°”ì¼ */
        @media (max-width: 480px) {
            .results-grid {
                grid-template-columns: 1fr;
            }

            .card {
                max-height: none;
            }

            .card-img {
                height: 180px;
            }
        }

        .dday-urgent {
            background: #ff4444;
            color: #fff;
        }

        .dday-soon {
            background: #ffaa00;
            color: #000;
        }

        .dday-normal {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }

        .card-body {
            padding: 15px;
            overflow: hidden;
        }

        .card-title {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #fff;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            max-height: 2.8em;
        }

        .card-info {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .card-info span {
            color: #00d4ff;
        }

        .card-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            margin-top: 10px;
        }

        .site-badges {
            display: flex;
            gap: 6px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .site-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: default;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #888;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner-lg {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #00d4ff;
            border-right-color: #7c3aed;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 25px;
        }

        .loading-container h3 {
            color: #fff;
            margin-bottom: 30px;
            font-size: 1.2rem;
        }

        .loading-steps {
            display: inline-flex;
            flex-direction: column;
            gap: 12px;
            text-align: left;
            margin-bottom: 30px;
        }

        .loading-step-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .loading-step-item.active {
            color: #00d4ff;
        }

        .loading-step-item.done {
            color: #00cd3c;
        }

        .loading-tip {
            color: #888;
            font-size: 0.9rem;
            margin-top: 10px;
            animation: pulse 2s ease-in-out infinite;
        }

        .bg-loading-bar {
            text-align: center;
            padding: 10px 20px;
            color: #888;
            font-size: 0.85rem;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #888;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 12px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 100px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
        }

        .source-section {
            margin-bottom: 40px;
        }

        .source-section h3 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .source-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        .modal-overlay.active {
            display: flex;
        }

        /* iOS í„°ì¹˜ ìµœì í™” */
        .modal-link-btn {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .modal {
            background: linear-gradient(135deg, #1e1e3f, #2a2a5a);
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            -webkit-overflow-scrolling: touch;
        }

        /* iOS body ìŠ¤í¬ë¡¤ ë°©ì§€ */
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 2px solid #fff;
            color: #fff;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #ff4444;
            border-color: #ff4444;
            transform: scale(1.1);
        }

        .modal-poster {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #2a2a4a, #1a1a3e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
        }

        .modal-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-content {
            padding: 25px;
        }

        .modal-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .modal-dday {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .modal-info {
            margin-bottom: 25px;
        }

        .modal-info-item {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .modal-info-label {
            width: 80px;
            color: #888;
            flex-shrink: 0;
        }

        .modal-info-value {
            color: #fff;
            flex: 1;
        }

        .modal-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .modal-link-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border-radius: 10px;
            text-decoration: none;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .modal-link-btn:hover {
            transform: translateY(-2px);
        }

        .link-interpark {
            background: #ff6464;
            color: #fff;
        }

        .link-melon {
            background: #00cd3c;
            color: #fff;
        }

        .link-yes24 {
            background: #ffc800;
            color: #000;
        }

        .link-kopis {
            background: #00d4ff;
            color: #000;
        }

        /* ì°œ(í•˜íŠ¸) ë²„íŠ¼ */
        .fav-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0,0,0,0.6);
            border: 2px solid rgba(255,255,255,0.3);
            color: #aaa;
            font-size: 1.1rem;
            cursor: pointer;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .fav-btn:hover {
            transform: scale(1.15);
            border-color: #ff4081;
        }

        .fav-btn.active {
            background: rgba(255, 64, 129, 0.9);
            border-color: #ff4081;
            color: #fff;
        }

        /* ëª¨ë‹¬ ì°œ ë²„íŠ¼ */
        .modal-fav-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #aaa;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
            vertical-align: middle;
        }

        .modal-fav-btn.active {
            background: rgba(255, 64, 129, 0.2);
            border-color: #ff4081;
            color: #ff4081;
        }

        /* ì•Œë¦¼ ë°” */
        .noti-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 12px 20px;
            margin-bottom: 20px;
        }

        .noti-bar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .noti-bar-label {
            color: #ccc;
            font-size: 0.9rem;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            cursor: pointer;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.15);
            border-radius: 13px;
            transition: 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: #fff;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: #ff4081;
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(22px);
        }

        /* ê´€ì‹¬ ê³µì—° ë°°ì§€ */
        .fav-count-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(255, 64, 129, 0.15);
            border: 1px solid rgba(255, 64, 129, 0.3);
            color: #ff4081;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fav-count-badge:hover {
            background: rgba(255, 64, 129, 0.25);
        }

        .fav-count-badge.filter-active {
            background: #ff4081;
            color: #fff;
            border-color: #ff4081;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ì¶”ê°€ */
        @media (max-width: 768px) {
            .fav-btn {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }

            .noti-bar {
                padding: 10px 14px;
                gap: 8px;
            }

            .noti-bar-label {
                font-size: 0.8rem;
            }

            .fav-count-badge {
                font-size: 0.75rem;
                padding: 4px 10px;
            }
        }

        footer {
            text-align: center;
            padding: 40px;
            color: #555;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 50px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .search-form {
                flex-direction: column;
            }

            .form-group {
                width: 100%;
            }

            .modal {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="home-btn" onclick="goHome()" title="í™ˆìœ¼ë¡œ">ğŸ </button>
            <div class="lang-selector">
                <select id="langSelect" onchange="changeLanguage(this.value)">
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                </select>
            </div>
            <h1 data-i18n="title">ê³µì—° í†µí•© ì •ë³´</h1>
            <p data-i18n="subtitle">ì½˜ì„œíŠ¸ Â· ë®¤ì§€ì»¬ Â· ì—°ê·¹ Â· K-POP Â· ë‚´í•œê³µì—°</p>
            <div class="update-info" id="updateInfo" data-i18n="lastUpdate">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</div>
        </header>

        <div class="search-box">
            <h2 data-i18n="search">ê³µì—° ê²€ìƒ‰</h2>
            <div class="search-form">
                <div class="form-group">
                    <label data-i18n="keyword">ê²€ìƒ‰ì–´</label>
                    <input type="text" id="keyword" data-i18n-placeholder="keywordPlaceholder" placeholder="ì•„í‹°ìŠ¤íŠ¸, ê³µì—°ëª… ì…ë ¥...">
                </div>
                <div class="form-group">
                    <label data-i18n="startDate">ì‹œì‘ì¼</label>
                    <input type="date" id="startDate">
                </div>
                <div class="form-group">
                    <label data-i18n="endDate">ì¢…ë£Œì¼</label>
                    <input type="date" id="endDate">
                </div>
                <button class="btn btn-primary" onclick="loadAllData()" data-i18n="searchBtn">ê²€ìƒ‰</button>
            </div>
        </div>

        <!-- ë·° ì „í™˜: ëª©ë¡ / ìº˜ë¦°ë” -->
        <div class="view-tabs">
            <button class="view-tab active" onclick="switchView('list', this)" data-i18n="listView">ğŸ“‹ ëª©ë¡ ë³´ê¸°</button>
            <button class="view-tab" onclick="switchView('calendar', this)" data-i18n="calendarView">ğŸ“… ìº˜ë¦°ë” ë³´ê¸°</button>
        </div>

        <!-- ì•Œë¦¼ ë°” -->
        <div class="noti-bar" id="notiBar">
            <div class="noti-bar-left">
                <span class="noti-bar-label">ì•Œë¦¼</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="notiToggle" onchange="toggleNotification(this.checked)">
                    <span class="toggle-slider"></span>
                </label>
                <span class="noti-bar-label" id="notiStatus" style="color: #666; font-size: 0.8rem;">ë¹„í™œì„±</span>
            </div>
            <div class="fav-count-badge" id="favCountBadge" onclick="toggleFavFilter()">
                â™¥ ê´€ì‹¬ <span id="favCount">0</span>ê±´
            </div>
        </div>

        <!-- ëª©ë¡ ë·° -->
        <div id="listView" class="list-view">
            <!-- ë©”ì¸ íŒŒíŠ¸ íƒ­ -->
            <div class="part-tabs">
                <button class="part-tab active" onclick="switchPart('concert', this)" data-i18n="concert">ğŸ¤ ì½˜ì„œíŠ¸</button>
                <button class="part-tab" onclick="switchPart('theater', this)" data-i18n="theater">ğŸ­ ì—°ê·¹ & ë®¤ì§€ì»¬</button>
            </div>

            <!-- ì†ŒìŠ¤ í•„í„° íƒ­ -->
            <div class="source-tabs">
                <button class="source-tab active" onclick="filterSource('all', this)" data-i18n="all">ì „ì²´</button>
                <button class="source-tab" onclick="filterSource('KOPIS', this)" style="border-color: #00d4ff;">KOPIS</button>
                <button class="source-tab" onclick="filterSource('ì¸í„°íŒŒí¬', this)" style="border-color: #ff6464;" data-i18n="interpark">ì¸í„°íŒŒí¬</button>
                <button class="source-tab" onclick="filterSource('ë©œë¡ í‹°ì¼“', this)" style="border-color: #00cd3c;" data-i18n="melon">ë©œë¡ </button>
                <button class="source-tab" onclick="filterSource('YES24', this)" style="border-color: #ffc800;">YES24</button>
            </div>

            <!-- ì§€ì—­ í•„í„° íƒ­ -->
            <div class="region-tabs" id="regionTabs">
                <button class="region-tab active" onclick="filterRegion('all', this)" data-i18n="all">ì „ì²´</button>
                <button class="region-tab" onclick="filterRegion('ì„œìš¸', this)" data-i18n="seoul">ì„œìš¸</button>
                <button class="region-tab" onclick="filterRegion('ê²½ê¸°Â·ì¸ì²œ', this)" data-i18n="gyeonggi">ê²½ê¸°Â·ì¸ì²œ</button>
                <button class="region-tab" onclick="filterRegion('ê°•ì›', this)" data-i18n="gangwon">ê°•ì›</button>
                <button class="region-tab" onclick="filterRegion('ì¶©ì²­', this)" data-i18n="chungcheong">ì¶©ì²­</button>
                <button class="region-tab" onclick="filterRegion('ì „ë¼', this)" data-i18n="jeolla">ì „ë¼</button>
                <button class="region-tab" onclick="filterRegion('ê²½ìƒ', this)" data-i18n="gyeongsang">ê²½ìƒ</button>
                <button class="region-tab" onclick="filterRegion('ì œì£¼', this)" data-i18n="jeju">ì œì£¼</button>
            </div>

            <!-- ì½˜ì„œíŠ¸ ì„¸ë¶€ ì¥ë¥´ íƒ­ (ì½˜ì„œíŠ¸ íŒŒíŠ¸ì—ì„œë§Œ í‘œì‹œ) -->
            <div class="tabs" id="genreTabs">
                <button class="tab-btn active" onclick="showTab('all', this)">ğŸ”¥ <span data-i18n="genreAll">ì „ì²´</span></button>
                <button class="tab-btn" onclick="showTab('ì•„ì´ëŒ', this)">ğŸ’œ <span data-i18n="genreIdol">ì•„ì´ëŒ/K-POP</span></button>
                <button class="tab-btn" onclick="showTab('ë°œë¼ë“œ', this)">ğŸ¤ <span data-i18n="genreBallad">ë°œë¼ë“œ</span></button>
                <button class="tab-btn" onclick="showTab('íŠ¸ë¡œíŠ¸', this)">ğŸ“º <span data-i18n="genreTrot">íŠ¸ë¡œíŠ¸</span></button>
                <button class="tab-btn" onclick="showTab('ë©/í™í•©', this)">ğŸ§ <span data-i18n="genreHiphop">ë©/í™í•©</span></button>
                <button class="tab-btn" onclick="showTab('ë½/ì¸ë””', this)">ğŸ¸ <span data-i18n="genreRock">ë½/ì¸ë””</span></button>
                <button class="tab-btn" onclick="showTab('ë‚´í•œê³µì—°', this)">ğŸŒ <span data-i18n="genreWorldtour">ë‚´í•œê³µì—°</span></button>
                <button class="tab-btn" onclick="showTab('íŒ¬ë¯¸íŒ…', this)">ğŸ‘¥ <span data-i18n="genreFanmeeting">íŒ¬ë¯¸íŒ…</span></button>
                <button class="tab-btn" onclick="showTab('í˜ìŠ¤í‹°ë²Œ', this)">ğŸª <span data-i18n="genreFestival">í˜ìŠ¤í‹°ë²Œ</span></button>
                <button class="tab-btn" onclick="showTab('ê¸°íƒ€', this)">ğŸ“Œ <span data-i18n="genreEtc">ê¸°íƒ€</span></button>
            </div>

        <div class="stats-bar" id="statsBar">
            <div class="stat-item">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">ì „ì²´</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="kopisCount">0</div>
                <div class="stat-label">KOPIS</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="interparkCount">0</div>
                <div class="stat-label">ì¸í„°íŒŒí¬</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="melonCount">0</div>
                <div class="stat-label">ë©œë¡ </div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="yes24Count">0</div>
                <div class="stat-label">YES24</div>
            </div>
        </div>

            <div id="results">
                <div class="empty-state">
                    <h3>ê³µì—° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”</h3>
                    <p>ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê³µì—° ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.</p>
                    <br>
                    <button class="btn btn-primary" onclick="loadAllData()">ì „ì²´ ê³µì—° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
            </div>
        </div><!-- /listView -->

        <!-- ìº˜ë¦°ë” ë·° -->
        <div id="calendarView" class="calendar-container">
            <div class="calendar-tabs">
                <button class="calendar-tab active" onclick="switchCalendar('ticket', this)">ğŸ« ì˜ˆë§¤ì˜¤í”ˆ ìº˜ë¦°ë”</button>
                <button class="calendar-tab concert-tab" onclick="switchCalendar('concert', this)">ğŸ¤ ê³µì—°ì¼ì • ìº˜ë¦°ë”</button>
            </div>
            <div class="calendar-wrapper">
                <div id="calendar"></div>
            </div>
            <div style="margin-top: 15px; text-align: center; color: #888; font-size: 0.85rem;">
                <span style="display: inline-block; width: 12px; height: 12px; background: #ff6464; border-radius: 3px; margin-right: 5px;"></span> ì˜ˆë§¤ì˜¤í”ˆì¼
                <span style="margin-left: 20px; display: inline-block; width: 12px; height: 12px; background: #00cd3c; border-radius: 3px; margin-right: 5px;"></span> ê³µì—°ì¼
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ íŒì—… ëª¨ë‹¬ -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div class="modal-poster" id="modalPoster">
                <span>No Image</span>
            </div>
            <div class="modal-content">
                <h2 class="modal-title" id="modalTitle">ê³µì—°ëª…</h2>
                <div class="modal-dday dday-normal" id="modalDday">D-day</div>
                <div class="modal-info">
                    <div class="modal-info-item">
                        <span class="modal-info-label">ê³µì—°ì¼</span>
                        <span class="modal-info-value" id="modalDate">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ì¥ì†Œ</span>
                        <span class="modal-info-value" id="modalVenue">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ì¥ë¥´</span>
                        <span class="modal-info-value" id="modalGenre">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">í‹°ì¼“ì˜¤í”ˆ</span>
                        <span class="modal-info-value" id="modalTicketOpen">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ê°€ê²©</span>
                        <span class="modal-info-value" id="modalPrice">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ì¶œì—°</span>
                        <span class="modal-info-value" id="modalCast">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ìƒíƒœ</span>
                        <span class="modal-info-value" id="modalState">-</span>
                    </div>
                </div>
                <div class="modal-links" id="modalLinks">
                    <!-- ì˜ˆë§¤ ë§í¬ ë²„íŠ¼ë“¤ -->
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>ê³µì—° í†µí•© ì •ë³´ ì‹œìŠ¤í…œ v3.3</p>
        <p style="margin-top: 10px; font-size: 0.85rem;">ë°ì´í„° ì¶œì²˜: KOPIS(ê³µì—°ì˜ˆìˆ í†µí•©ì „ì‚°ë§), ì¸í„°íŒŒí¬, ë©œë¡ í‹°ì¼“, YES24</p>
        <p style="margin-top: 5px; font-size: 0.8rem; color: #555;">ì½˜ì„œíŠ¸ / ì—°ê·¹ & ë®¤ì§€ì»¬ íŒŒíŠ¸ ë¶„ë¥˜ Â· 7ê°œ ê¶Œì—­ ì§€ì—­ í•„í„° Â· 12ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸ Â· ì°œ/ì•Œë¦¼</p>
    </footer>

    <script>
        // =============================================
        // ë‹¤êµ­ì–´ ì§€ì› (i18n)
        // =============================================
        const i18n = {
            ko: {
                title: 'ê³µì—° í†µí•© ì •ë³´',
                subtitle: 'ì½˜ì„œíŠ¸ Â· ë®¤ì§€ì»¬ Â· ì—°ê·¹ Â· K-POP Â· ë‚´í•œê³µì—°',
                lastUpdate: 'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸',
                search: 'ê³µì—° ê²€ìƒ‰',
                keyword: 'ê²€ìƒ‰ì–´',
                keywordPlaceholder: 'ì•„í‹°ìŠ¤íŠ¸, ê³µì—°ëª… ì…ë ¥...',
                startDate: 'ì‹œì‘ì¼',
                endDate: 'ì¢…ë£Œì¼',
                searchBtn: 'ê²€ìƒ‰',
                listView: 'ğŸ“‹ ëª©ë¡ ë³´ê¸°',
                calendarView: 'ğŸ“… ìº˜ë¦°ë” ë³´ê¸°',
                concert: 'ğŸ¤ ì½˜ì„œíŠ¸',
                theater: 'ğŸ­ ì—°ê·¹ & ë®¤ì§€ì»¬',
                all: 'ì „ì²´',
                interpark: 'ì¸í„°íŒŒí¬',
                melon: 'ë©œë¡ ',
                seoul: 'ì„œìš¸',
                gyeonggi: 'ê²½ê¸°Â·ì¸ì²œ',
                gangwon: 'ê°•ì›',
                chungcheong: 'ì¶©ì²­',
                jeolla: 'ì „ë¼',
                gyeongsang: 'ê²½ìƒ',
                jeju: 'ì œì£¼',
                notification: 'ì•Œë¦¼',
                inactive: 'ë¹„í™œì„±',
                active: 'í™œì„±',
                unsupportedDevice: 'ë¯¸ì§€ì› ê¸°ê¸°',
                favorites: 'ê´€ì‹¬',
                total: 'ì „ì²´',
                venue: 'ì¥ì†Œ',
                period: 'ê¸°ê°„',
                date: 'ë‚ ì§œ',
                ticketOpen: 'í‹°ì¼“ì˜¤í”ˆ',
                noResults: 'ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤',
                tryOther: 'ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë‚˜ ë‚ ì§œë¡œ ì‹œë„í•´ë³´ì„¸ìš”.',
                loading: 'ê³µì—° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤',
                loadingKopis: 'KOPIS ê³µì—° ë°ì´í„° ì¡°íšŒ ì¤‘...',
                performanceList: 'ê³µì—° ëª©ë¡',
                sortByDday: 'D-day ìˆœ ì •ë ¬',
                ticketOpenCalendar: 'ğŸ« ì˜ˆë§¤ì˜¤í”ˆ ìº˜ë¦°ë”',
                concertCalendar: 'ğŸ¤ ê³µì—°ì¼ì • ìº˜ë¦°ë”',
                genre: 'ì¥ë¥´',
                price: 'ê°€ê²©',
                cast: 'ì¶œì—°',
                status: 'ìƒíƒœ',
                booking: 'ì˜ˆë§¤',
                noTitle: 'ì œëª© ì—†ìŒ',
                addFavorite: 'ê´€ì‹¬ ë“±ë¡',
                removeFavorite: 'ì°œ í•´ì œ',
                addToFavorite: 'ì°œí•˜ê¸°',
                count: 'ê±´',
                idol: 'ì•„ì´ëŒ',
                ballad: 'ë°œë¼ë“œ',
                hiphop: 'ë©/í™í•©',
                rock: 'ë½/ì¸ë””',
                worldtour: 'ë‚´í•œê³µì—°',
                fanmeeting: 'íŒ¬ë¯¸íŒ…',
                festival: 'í˜ìŠ¤í‹°ë²Œ',
                trot: 'íŠ¸ë¡œíŠ¸',
                etc: 'ê¸°íƒ€',
                genreAll: 'ì „ì²´',
                genreIdol: 'ì•„ì´ëŒ/K-POP',
                genreBallad: 'ë°œë¼ë“œ',
                genreTrot: 'íŠ¸ë¡œíŠ¸',
                genreHiphop: 'ë©/í™í•©',
                genreRock: 'ë½/ì¸ë””',
                genreWorldtour: 'ë‚´í•œê³µì—°',
                genreFanmeeting: 'íŒ¬ë¯¸íŒ…',
                genreFestival: 'í˜ìŠ¤í‹°ë²Œ',
                genreEtc: 'ê¸°íƒ€'
            },
            en: {
                title: 'Performance Info',
                subtitle: 'Concert Â· Musical Â· Theater Â· K-POP Â· World Tour',
                lastUpdate: 'Last Update',
                search: 'Search',
                keyword: 'Keyword',
                keywordPlaceholder: 'Enter artist or show name...',
                startDate: 'Start Date',
                endDate: 'End Date',
                searchBtn: 'Search',
                listView: 'ğŸ“‹ List View',
                calendarView: 'ğŸ“… Calendar View',
                concert: 'ğŸ¤ Concert',
                theater: 'ğŸ­ Theater & Musical',
                all: 'All',
                interpark: 'Interpark',
                melon: 'Melon',
                seoul: 'Seoul',
                gyeonggi: 'Gyeonggi',
                gangwon: 'Gangwon',
                chungcheong: 'Chungcheong',
                jeolla: 'Jeolla',
                gyeongsang: 'Gyeongsang',
                jeju: 'Jeju',
                notification: 'Notification',
                inactive: 'Inactive',
                active: 'Active',
                unsupportedDevice: 'Unsupported',
                favorites: 'Favorites',
                total: 'Total',
                venue: 'Venue',
                period: 'Period',
                date: 'Date',
                ticketOpen: 'Ticket Open',
                noResults: 'No results found',
                tryOther: 'Try different keywords or dates.',
                loading: 'Loading performance data',
                loadingKopis: 'Fetching KOPIS data...',
                performanceList: 'Performance List',
                sortByDday: 'Sorted by D-day',
                ticketOpenCalendar: 'ğŸ« Ticket Open Calendar',
                concertCalendar: 'ğŸ¤ Concert Calendar',
                genre: 'Genre',
                price: 'Price',
                cast: 'Cast',
                status: 'Status',
                booking: 'Book',
                noTitle: 'No Title',
                addFavorite: 'Add Favorite',
                removeFavorite: 'Remove Favorite',
                addToFavorite: 'Add to Favorites',
                count: '',
                idol: 'K-Pop/Idol',
                ballad: 'Ballad',
                hiphop: 'Hip-Hop',
                rock: 'Rock/Indie',
                worldtour: 'World Tour',
                fanmeeting: 'Fan Meeting',
                festival: 'Festival',
                trot: 'Trot',
                etc: 'Others',
                genreAll: 'All',
                genreIdol: 'K-Pop/Idol',
                genreBallad: 'Ballad',
                genreTrot: 'Trot',
                genreHiphop: 'Hip-Hop',
                genreRock: 'Rock/Indie',
                genreWorldtour: 'World Tour',
                genreFanmeeting: 'Fan Meeting',
                genreFestival: 'Festival',
                genreEtc: 'Others'
            },
            ja: {
                title: 'å…¬æ¼”çµ±åˆæƒ…å ±',
                subtitle: 'ã‚³ãƒ³ã‚µãƒ¼ãƒˆ Â· ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ« Â· æ¼”åŠ‡ Â· K-POP Â· æ¥éŸ“å…¬æ¼”',
                lastUpdate: 'æœ€çµ‚æ›´æ–°',
                search: 'å…¬æ¼”æ¤œç´¢',
                keyword: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰',
                keywordPlaceholder: 'ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã€å…¬æ¼”åã‚’å…¥åŠ›...',
                startDate: 'é–‹å§‹æ—¥',
                endDate: 'çµ‚äº†æ—¥',
                searchBtn: 'æ¤œç´¢',
                listView: 'ğŸ“‹ ãƒªã‚¹ãƒˆè¡¨ç¤º',
                calendarView: 'ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º',
                concert: 'ğŸ¤ ã‚³ãƒ³ã‚µãƒ¼ãƒˆ',
                theater: 'ğŸ­ æ¼”åŠ‡ & ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ«',
                all: 'å…¨ä½“',
                interpark: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ‘ãƒ¼ã‚¯',
                melon: 'ãƒ¡ãƒ­ãƒ³',
                seoul: 'ã‚½ã‚¦ãƒ«',
                gyeonggi: 'äº¬ç•¿Â·ä»å·',
                gangwon: 'æ±ŸåŸ',
                chungcheong: 'å¿ æ¸…',
                jeolla: 'å…¨ç¾…',
                gyeongsang: 'æ…¶å°š',
                jeju: 'æ¸ˆå·',
                notification: 'é€šçŸ¥',
                inactive: 'ç„¡åŠ¹',
                active: 'æœ‰åŠ¹',
                unsupportedDevice: 'éå¯¾å¿œ',
                favorites: 'ãŠæ°—ã«å…¥ã‚Š',
                total: 'å…¨ä½“',
                venue: 'ä¼šå ´',
                period: 'æœŸé–“',
                date: 'æ—¥ä»˜',
                ticketOpen: 'ãƒã‚±ãƒƒãƒˆç™ºå£²',
                noResults: 'çµæœãŒã‚ã‚Šã¾ã›ã‚“',
                tryOther: 'ä»–ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„æ—¥ä»˜ã§ãŠè©¦ã—ãã ã•ã„ã€‚',
                loading: 'å…¬æ¼”æƒ…å ±ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™',
                loadingKopis: 'KOPISãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...',
                performanceList: 'å…¬æ¼”ãƒªã‚¹ãƒˆ',
                sortByDday: 'D-dayé †',
                ticketOpenCalendar: 'ğŸ« ãƒã‚±ãƒƒãƒˆç™ºå£²ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼',
                concertCalendar: 'ğŸ¤ å…¬æ¼”æ—¥ç¨‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼',
                genre: 'ã‚¸ãƒ£ãƒ³ãƒ«',
                price: 'ä¾¡æ ¼',
                cast: 'å‡ºæ¼”',
                status: 'çŠ¶æ…‹',
                booking: 'äºˆç´„',
                noTitle: 'ã‚¿ã‚¤ãƒˆãƒ«ãªã—',
                addFavorite: 'ãŠæ°—ã«å…¥ã‚Šç™»éŒ²',
                removeFavorite: 'ãŠæ°—ã«å…¥ã‚Šè§£é™¤',
                addToFavorite: 'ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ',
                count: 'ä»¶',
                idol: 'K-POP/ã‚¢ã‚¤ãƒ‰ãƒ«',
                ballad: 'ãƒãƒ©ãƒ¼ãƒ‰',
                hiphop: 'ãƒ’ãƒƒãƒ—ãƒ›ãƒƒãƒ—',
                rock: 'ãƒ­ãƒƒã‚¯/ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼',
                worldtour: 'æ¥éŸ“å…¬æ¼”',
                fanmeeting: 'ãƒ•ã‚¡ãƒ³ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°',
                festival: 'ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ«',
                trot: 'ãƒˆãƒ­ãƒƒãƒˆ',
                etc: 'ãã®ä»–',
                genreAll: 'å…¨ä½“',
                genreIdol: 'K-POP/ã‚¢ã‚¤ãƒ‰ãƒ«',
                genreBallad: 'ãƒãƒ©ãƒ¼ãƒ‰',
                genreTrot: 'ãƒˆãƒ­ãƒƒãƒˆ',
                genreHiphop: 'ãƒ’ãƒƒãƒ—ãƒ›ãƒƒãƒ—',
                genreRock: 'ãƒ­ãƒƒã‚¯/ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼',
                genreWorldtour: 'æ¥éŸ“å…¬æ¼”',
                genreFanmeeting: 'ãƒ•ã‚¡ãƒ³ãƒŸ',
                genreFestival: 'ãƒ•ã‚§ã‚¹',
                genreEtc: 'ãã®ä»–'
            },
            zh: {
                title: 'æ¼”å‡ºç»¼åˆä¿¡æ¯',
                subtitle: 'æ¼”å”±ä¼š Â· éŸ³ä¹å‰§ Â· è¯å‰§ Â· K-POP Â· å·¡å›æ¼”å‡º',
                lastUpdate: 'æœ€åæ›´æ–°',
                search: 'æœç´¢æ¼”å‡º',
                keyword: 'å…³é”®è¯',
                keywordPlaceholder: 'è¾“å…¥è‰ºäººæˆ–æ¼”å‡ºåç§°...',
                startDate: 'å¼€å§‹æ—¥æœŸ',
                endDate: 'ç»“æŸæ—¥æœŸ',
                searchBtn: 'æœç´¢',
                listView: 'ğŸ“‹ åˆ—è¡¨è§†å›¾',
                calendarView: 'ğŸ“… æ—¥å†è§†å›¾',
                concert: 'ğŸ¤ æ¼”å”±ä¼š',
                theater: 'ğŸ­ è¯å‰§ & éŸ³ä¹å‰§',
                all: 'å…¨éƒ¨',
                interpark: 'Interpark',
                melon: 'Melon',
                seoul: 'é¦–å°”',
                gyeonggi: 'äº¬ç•¿Â·ä»å·',
                gangwon: 'æ±ŸåŸ',
                chungcheong: 'å¿ æ¸…',
                jeolla: 'å…¨ç½—',
                gyeongsang: 'åº†å°š',
                jeju: 'æµå·',
                notification: 'é€šçŸ¥',
                inactive: 'æœªå¯ç”¨',
                active: 'å·²å¯ç”¨',
                unsupportedDevice: 'ä¸æ”¯æŒ',
                favorites: 'æ”¶è—',
                total: 'æ€»è®¡',
                venue: 'åœºé¦†',
                period: 'æ—¶é—´',
                date: 'æ—¥æœŸ',
                ticketOpen: 'å¼€ç¥¨',
                noResults: 'æ²¡æœ‰ç»“æœ',
                tryOther: 'è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ—¥æœŸã€‚',
                loading: 'æ­£åœ¨åŠ è½½æ¼”å‡ºä¿¡æ¯',
                loadingKopis: 'æ­£åœ¨è·å–KOPISæ•°æ®...',
                performanceList: 'æ¼”å‡ºåˆ—è¡¨',
                sortByDday: 'æŒ‰D-dayæ’åº',
                ticketOpenCalendar: 'ğŸ« å¼€ç¥¨æ—¥å†',
                concertCalendar: 'ğŸ¤ æ¼”å‡ºæ—¥å†',
                genre: 'ç±»å‹',
                price: 'ä»·æ ¼',
                cast: 'æ¼”å‘˜',
                status: 'çŠ¶æ€',
                booking: 'é¢„è®¢',
                noTitle: 'æ— æ ‡é¢˜',
                addFavorite: 'æ”¶è—',
                removeFavorite: 'å–æ¶ˆæ”¶è—',
                addToFavorite: 'æ·»åŠ æ”¶è—',
                count: 'ä¸ª',
                idol: 'K-POP/å¶åƒ',
                ballad: 'æŠ’æƒ…',
                hiphop: 'å˜»å“ˆ',
                rock: 'æ‘‡æ»š/ç‹¬ç«‹',
                worldtour: 'å·¡æ¼”',
                fanmeeting: 'ç²‰ä¸è§é¢ä¼š',
                festival: 'éŸ³ä¹èŠ‚',
                trot: 'æ¼”æ­Œ',
                etc: 'å…¶ä»–',
                genreAll: 'å…¨éƒ¨',
                genreIdol: 'K-POP/å¶åƒ',
                genreBallad: 'æŠ’æƒ…',
                genreTrot: 'æ¼”æ­Œ',
                genreHiphop: 'å˜»å“ˆ',
                genreRock: 'æ‘‡æ»š/ç‹¬ç«‹',
                genreWorldtour: 'å·¡æ¼”',
                genreFanmeeting: 'ç²‰ä¸è§é¢ä¼š',
                genreFestival: 'éŸ³ä¹èŠ‚',
                genreEtc: 'å…¶ä»–'
            },
            es: {
                title: 'Info de EspectÃ¡culos',
                subtitle: 'Concierto Â· Musical Â· Teatro Â· K-POP Â· Gira Mundial',
                lastUpdate: 'Ãšltima actualizaciÃ³n',
                search: 'Buscar',
                keyword: 'Palabra clave',
                keywordPlaceholder: 'Ingrese artista o nombre del show...',
                startDate: 'Fecha inicio',
                endDate: 'Fecha fin',
                searchBtn: 'Buscar',
                listView: 'ğŸ“‹ Vista Lista',
                calendarView: 'ğŸ“… Vista Calendario',
                concert: 'ğŸ¤ Concierto',
                theater: 'ğŸ­ Teatro & Musical',
                all: 'Todo',
                interpark: 'Interpark',
                melon: 'Melon',
                seoul: 'SeÃºl',
                gyeonggi: 'Gyeonggi',
                gangwon: 'Gangwon',
                chungcheong: 'Chungcheong',
                jeolla: 'Jeolla',
                gyeongsang: 'Gyeongsang',
                jeju: 'Jeju',
                notification: 'NotificaciÃ³n',
                inactive: 'Inactivo',
                active: 'Activo',
                unsupportedDevice: 'No soportado',
                favorites: 'Favoritos',
                total: 'Total',
                venue: 'Lugar',
                period: 'PerÃ­odo',
                date: 'Fecha',
                ticketOpen: 'Venta de boletos',
                noResults: 'Sin resultados',
                tryOther: 'Intente con otras palabras o fechas.',
                loading: 'Cargando informaciÃ³n',
                loadingKopis: 'Obteniendo datos de KOPIS...',
                performanceList: 'Lista de EspectÃ¡culos',
                sortByDday: 'Ordenado por D-day',
                ticketOpenCalendar: 'ğŸ« Calendario de Ventas',
                concertCalendar: 'ğŸ¤ Calendario de Conciertos',
                genre: 'GÃ©nero',
                price: 'Precio',
                cast: 'Elenco',
                status: 'Estado',
                booking: 'Reservar',
                noTitle: 'Sin TÃ­tulo',
                addFavorite: 'Agregar Favorito',
                removeFavorite: 'Quitar Favorito',
                addToFavorite: 'Agregar a Favoritos',
                count: '',
                idol: 'K-Pop/Idol',
                ballad: 'Balada',
                hiphop: 'Hip-Hop',
                rock: 'Rock/Indie',
                worldtour: 'Gira Mundial',
                fanmeeting: 'Fan Meeting',
                festival: 'Festival',
                trot: 'Trot',
                etc: 'Otros',
                genreAll: 'Todo',
                genreIdol: 'K-Pop/Idol',
                genreBallad: 'Balada',
                genreTrot: 'Trot',
                genreHiphop: 'Hip-Hop',
                genreRock: 'Rock/Indie',
                genreWorldtour: 'Gira Mundial',
                genreFanmeeting: 'Fan Meeting',
                genreFestival: 'Festival',
                genreEtc: 'Otros'
            }
        };

        let currentLang = localStorage.getItem('ticket_lang') || 'ko';

        // ë²ˆì—­ ìºì‹œ (LocalStorage)
        const translationCache = JSON.parse(localStorage.getItem('ticket_translations') || '{}');
        let isTranslating = false;

        function saveTranslationCache() {
            // ìºì‹œ í¬ê¸° ì œí•œ (ìµœëŒ€ 500ê°œ)
            const keys = Object.keys(translationCache);
            if (keys.length > 500) {
                keys.slice(0, keys.length - 500).forEach(k => delete translationCache[k]);
            }
            localStorage.setItem('ticket_translations', JSON.stringify(translationCache));
        }

        async function translateText(text, toLang) {
            if (!text || toLang === 'ko') return text;

            const cacheKey = `${text}|${toLang}`;
            if (translationCache[cacheKey]) {
                return translationCache[cacheKey];
            }

            try {
                const response = await fetch(`/api/translate?text=${encodeURIComponent(text)}&to=${toLang}&from=ko`);
                const data = await response.json();
                if (data.success) {
                    translationCache[cacheKey] = data.translated;
                    return data.translated;
                }
            } catch (e) {
                console.error('ë²ˆì—­ ì˜¤ë¥˜:', e);
            }
            return text;
        }

        async function translateDataForDisplay() {
            if (currentLang === 'ko' || !allData || allData.length === 0) {
                renderResults();
                return;
            }

            isTranslating = true;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<div class="loading-container"><div class="loading-spinner-lg"></div><h3>ğŸŒ ${currentLang === 'en' ? 'Translating...' : currentLang === 'ja' ? 'ç¿»è¨³ä¸­...' : currentLang === 'zh' ? 'ç¿»è¯‘ä¸­...' : 'Traduciendo...'}</h3></div>`;

            // í˜„ì¬ í•„í„°ëœ ë°ì´í„°ë§Œ ë²ˆì—­ (ìµœëŒ€ 30ê°œ)
            let filteredData = allData.filter(item => (item.part || 'concert') === currentPart);
            if (currentSource !== 'all') {
                filteredData = filteredData.filter(item => {
                    if (item.available_sites) return item.available_sites.some(site => site.name === currentSource);
                    return item.source === currentSource;
                });
            }
            if (currentRegion !== 'all') {
                filteredData = filteredData.filter(item => item.region === currentRegion);
            }

            const toTranslate = filteredData.slice(0, 30);

            for (const item of toTranslate) {
                const hash = item.hash;
                if (!hash) continue;

                // ì´ë¯¸ ë²ˆì—­ëœ ê²½ìš° ìŠ¤í‚µ
                const cacheKey = `${item.name}|${currentLang}`;
                if (translationCache[cacheKey]) {
                    item._translated_name = translationCache[cacheKey];
                } else if (item.name) {
                    item._translated_name = await translateText(item.name, currentLang);
                }

                const venueCacheKey = `${item.venue}|${currentLang}`;
                if (translationCache[venueCacheKey]) {
                    item._translated_venue = translationCache[venueCacheKey];
                } else if (item.venue) {
                    item._translated_venue = await translateText(item.venue, currentLang);
                }
            }

            saveTranslationCache();
            isTranslating = false;
            renderResults();
        }

        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('ticket_lang', lang);
            applyLanguage();

            // í•œêµ­ì–´ê°€ ì•„ë‹ˆë©´ ë°ì´í„° ë²ˆì—­
            if (lang !== 'ko' && allData && allData.length > 0) {
                translateDataForDisplay();
            }
        }

        function applyLanguage() {
            const texts = i18n[currentLang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (texts[key]) {
                    el.textContent = texts[key];
                }
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (texts[key]) {
                    el.placeholder = texts[key];
                }
            });
            document.getElementById('langSelect').value = currentLang;
            document.title = texts.title;
            // í˜„ì¬ í‘œì‹œëœ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë‹¤ì‹œ ë Œë”ë§ (í•œêµ­ì–´ì¼ë•Œë§Œ)
            if (currentLang === 'ko' && allData && allData.length > 0) {
                renderResults();
            }
        }

        function t(key) {
            return i18n[currentLang][key] || i18n['ko'][key] || key;
        }

        // ë²ˆì—­ëœ í…ìŠ¤íŠ¸ ë°˜í™˜ (ì—†ìœ¼ë©´ ì›ë³¸)
        function getTranslatedText(item, field) {
            if (currentLang === 'ko') return item[field] || '';
            const translatedField = `_translated_${field}`;
            return item[translatedField] || item[field] || '';
        }

        // í˜„ì¬ ë‚ ì§œ ì„¤ì •
        const today = new Date();
        const sixtyDaysLater = new Date(today.getTime() + 60 * 24 * 60 * 60 * 1000);

        document.getElementById('startDate').value = today.toISOString().split('T')[0];
        document.getElementById('endDate').value = sixtyDaysLater.toISOString().split('T')[0];

        let allData = [];  // í†µí•©ëœ ê³µì—° ë¦¬ìŠ¤íŠ¸
        let allDataMap = {};  // hash -> item ë§¤í•‘
        let currentFilter = 'all';  // ì¥ë¥´ í•„í„°
        let currentPart = 'concert';  // íŒŒíŠ¸ í•„í„°: concert / theater
        let currentSource = 'all';  // ì†ŒìŠ¤ í•„í„°: all / KOPIS / ì¸í„°íŒŒí¬ / ë©œë¡ í‹°ì¼“ / YES24
        let currentRegion = 'all';  // ì§€ì—­ í•„í„°: all / ì„œìš¸ / ê²½ê¸°Â·ì¸ì²œ / ê°•ì› / ì¶©ì²­ / ì „ë¼ / ê²½ìƒ / ì œì£¼
        let currentView = 'list';  // í˜„ì¬ ë·°: list, calendar
        let currentCalendarType = 'ticket';  // ìº˜ë¦°ë” íƒ€ì…: ticket, concert
        let calendar = null;  // FullCalendar ì¸ìŠ¤í„´ìŠ¤
        let favFilterActive = false;  // ê´€ì‹¬ ê³µì—°ë§Œ ë³´ê¸° í•„í„°

        // í™ˆìœ¼ë¡œ ì´ë™ (ì´ˆê¸°í™”)
        function goHome() {
            currentPart = 'concert';
            currentSource = 'all';
            currentFilter = 'all';
            document.querySelectorAll('.part-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.part-tab').classList.add('active');
            document.querySelectorAll('.source-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.source-tab').classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.tab-btn').classList.add('active');
            currentRegion = 'all';
            document.querySelectorAll('.region-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.region-tab').classList.add('active');
            document.getElementById('keyword').value = '';
            document.getElementById('genreTabs').style.display = 'flex';
            loadAllData();
        }

        // íŒŒíŠ¸ ì „í™˜ (ì½˜ì„œíŠ¸ / ì—°ê·¹&ë®¤ì§€ì»¬)
        function switchPart(part, btn) {
            currentPart = part;
            currentFilter = 'all';  // ì¥ë¥´ í•„í„° ì´ˆê¸°í™”
            document.querySelectorAll('.part-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            // ì¥ë¥´ íƒ­ì€ ì½˜ì„œíŠ¸ íŒŒíŠ¸ì—ì„œë§Œ í‘œì‹œ
            const genreTabs = document.getElementById('genreTabs');
            if (part === 'concert') {
                genreTabs.style.display = 'flex';
            } else {
                genreTabs.style.display = 'none';
            }

            // ì¥ë¥´ íƒ­ ì´ˆê¸°í™”
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.tab-btn').classList.add('active');

            renderResults();
            // ìº˜ë¦°ë” ì—…ë°ì´íŠ¸
            if (currentView === 'calendar' && calendar) {
                updateCalendarEvents();
            }
        }

        // ì†ŒìŠ¤ í•„í„°
        function filterSource(source, btn) {
            currentSource = source;
            document.querySelectorAll('.source-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
        }

        // ì§€ì—­ í•„í„°
        function filterRegion(region, btn) {
            currentRegion = region;
            document.querySelectorAll('.region-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
            if (currentView === 'calendar' && calendar) {
                updateCalendarEvents();
            }
        }

        // ë·° ì „í™˜ (ëª©ë¡ / ìº˜ë¦°ë”)
        function switchView(view, btn) {
            currentView = view;
            document.querySelectorAll('.view-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            if (view === 'list') {
                document.getElementById('listView').style.display = 'block';
                document.getElementById('calendarView').classList.remove('active');
            } else {
                document.getElementById('listView').style.display = 'none';
                document.getElementById('calendarView').classList.add('active');
                initCalendar();
            }
        }

        // ìº˜ë¦°ë” íƒ€ì… ì „í™˜ (ì˜ˆë§¤ì˜¤í”ˆ / ê³µì—°ì¼ì •)
        function switchCalendar(type, btn) {
            currentCalendarType = type;
            document.querySelectorAll('.calendar-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            updateCalendarEvents();
        }

        // ìº˜ë¦°ë” ì´ˆê¸°í™”
        function initCalendar() {
            if (calendar) {
                updateCalendarEvents();
                return;
            }

            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,listMonth'
                },
                buttonText: {
                    today: 'ì˜¤ëŠ˜',
                    month: 'ì›”ê°„',
                    list: 'ëª©ë¡'
                },
                height: 'auto',
                eventClick: function(info) {
                    const item = info.event.extendedProps.item;
                    if (item) showDetail(item);
                },
                eventDidMount: function(info) {
                    // íˆ´íŒ ì¶”ê°€
                    info.el.title = info.event.title;
                }
            });
            calendar.render();
            updateCalendarEvents();
        }

        // ìº˜ë¦°ë” ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateCalendarEvents() {
            if (!calendar) return;

            // ê¸°ì¡´ ì´ë²¤íŠ¸ ì‚­ì œ
            calendar.removeAllEvents();

            // íŒŒíŠ¸ + ì§€ì—­ í•„í„° ì ìš©
            let filteredData = allData.filter(item => {
                const itemPart = item.part || 'concert';
                if (itemPart !== currentPart) return false;
                if (currentRegion !== 'all' && item.region !== currentRegion) return false;
                return true;
            });

            // ìƒˆ ì´ë²¤íŠ¸ ì¶”ê°€
            const events = [];
            filteredData.forEach(item => {
                if (currentCalendarType === 'ticket') {
                    // ì˜ˆë§¤ì˜¤í”ˆ ìº˜ë¦°ë” - ticket_open ë‚ ì§œ ì‚¬ìš©
                    if (item.ticket_open) {
                        const dateMatch = item.ticket_open.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                        if (dateMatch) {
                            events.push({
                                title: item.name.substring(0, 20) + (item.name.length > 20 ? '...' : ''),
                                start: `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`,
                                className: 'ticket-open',
                                extendedProps: { item: item }
                            });
                        }
                    }
                } else {
                    // ê³µì—°ì¼ì • ìº˜ë¦°ë” - start_date ë˜ëŠ” date ì‚¬ìš©
                    let dateStr = item.start_date || item.date || '';
                    const dateMatch = dateStr.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (dateMatch) {
                        let endDate = null;
                        if (item.end_date) {
                            const endMatch = item.end_date.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                            if (endMatch) {
                                // ì¢…ë£Œì¼ +1ì¼ (FullCalendarëŠ” ì¢…ë£Œì¼ ë¯¸í¬í•¨)
                                const ed = new Date(`${endMatch[1]}-${endMatch[2]}-${endMatch[3]}`);
                                ed.setDate(ed.getDate() + 1);
                                endDate = ed.toISOString().split('T')[0];
                            }
                        }
                        events.push({
                            title: item.name.substring(0, 20) + (item.name.length > 20 ? '...' : ''),
                            start: `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`,
                            end: endDate,
                            className: 'concert-date',
                            extendedProps: { item: item }
                        });
                    }
                }
            });

            calendar.addEventSource(events);
        }

        // íƒ­ ì „í™˜ (ì„¸ë¶€ ì¥ë¥´ í•„í„°)
        function showTab(filter, btn) {
            currentFilter = filter;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
        }

        // ì „ì²´ ë°ì´í„° ë¡œë“œ (2ë‹¨ê³„: ë¹ ë¥¸ ë¡œë”© â†’ ë°±ê·¸ë¼ìš´ë“œ ì¶”ê°€)
        async function loadAllData() {
            const resultsDiv = document.getElementById('results');
            const startDate = document.getElementById('startDate').value.replace(/-/g, '');
            const endDate = document.getElementById('endDate').value.replace(/-/g, '');

            // ë¡œë”© UI í‘œì‹œ
            const tips = [
                'KOPIS ê³µì—°ì˜ˆìˆ í†µí•©ì „ì‚°ë§ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...',
                'ì¸í„°íŒŒí¬ í‹°ì¼“ ì •ë³´ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...',
                'ê³µì—° ì •ë³´ë¥¼ ì½˜ì„œíŠ¸ / ì—°ê·¹&ë®¤ì§€ì»¬ë¡œ ë¶„ë¥˜í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
                'ì„œìš¸, ê²½ê¸°, ê°•ì› ë“± 7ê°œ ê¶Œì—­ìœ¼ë¡œ ì§€ì—­ì„ ë¶„ë¥˜ ì¤‘...',
                'ì¤‘ë³µ ê³µì—°ì„ ì •ë¦¬í•˜ê³  íŒë§¤ì²˜ë¥¼ í†µí•©í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
                'ê±°ì˜ ë‹¤ ëì–´ìš”! ì¡°ê¸ˆë§Œ ë” ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...'
            ];

            resultsDiv.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner-lg"></div>
                    <h3>${t('loading')}</h3>
                    <div class="loading-steps">
                        <div class="loading-step-item active" id="stepKopis">â³ KOPIS ê³µì—° ë°ì´í„° ì¡°íšŒ ì¤‘...</div>
                        <div class="loading-step-item" id="stepInterpark">â³ ì¸í„°íŒŒí¬ í‹°ì¼“ ì¡°íšŒ ëŒ€ê¸°</div>
                        <div class="loading-step-item" id="stepMelon">â³ ë©œë¡ í‹°ì¼“ ëŒ€ê¸°</div>
                        <div class="loading-step-item" id="stepYes24">â³ YES24 ëŒ€ê¸°</div>
                    </div>
                    <div class="loading-tip" id="loadingTip">${tips[0]}</div>
                </div>
            `;

            // íŒ ë¡œí…Œì´ì…˜
            let tipIdx = 0;
            const tipInterval = setInterval(() => {
                tipIdx = (tipIdx + 1) % tips.length;
                const el = document.getElementById('loadingTip');
                if (el) el.textContent = tips[tipIdx];
            }, 3000);

            try {
                // Phase 1: ë¹ ë¥¸ ë¡œë”© (KOPIS + ì¸í„°íŒŒí¬ë§Œ, Selenium ì œì™¸)
                const fastResponse = await fetch(`/api/all?start_date=${startDate}&end_date=${endDate}&skip_selenium=true`);
                const fastResult = await fastResponse.json();

                clearInterval(tipInterval);

                if (fastResult.success) {
                    allData = fastResult.data;
                    allDataMap = {};
                    allData.forEach(item => {
                        if (item.hash) allDataMap[item.hash] = item;
                    });
                    updateStats(fastResult.stats);
                    document.getElementById('updateInfo').textContent = `${t('lastUpdate')}: ${fastResult.timestamp}`;
                    renderResults();
                    if (currentView === 'calendar' && calendar) {
                        updateCalendarEvents();
                    }

                    // Phase 2: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë©œë¡ /YES24 ì¶”ê°€ ë¡œë”©
                    const bgBar = document.createElement('div');
                    bgBar.id = 'bgLoadingBar';
                    bgBar.className = 'bg-loading-bar';
                    bgBar.innerHTML = 'ğŸ”„ ë©œë¡ í‹°ì¼“ Â· YES24 ì¶”ê°€ ë°ì´í„° ë¡œë”© ì¤‘...';
                    resultsDiv.parentNode.insertBefore(bgBar, resultsDiv);

                    fetch(`/api/all?start_date=${startDate}&end_date=${endDate}`)
                        .then(r => r.json())
                        .then(fullResult => {
                            const bar = document.getElementById('bgLoadingBar');
                            if (bar) bar.remove();
                            if (fullResult.success && fullResult.data.length > allData.length) {
                                allData = fullResult.data;
                                allDataMap = {};
                                allData.forEach(item => {
                                    if (item.hash) allDataMap[item.hash] = item;
                                });
                                updateStats(fullResult.stats);
                                renderResults();
                                if (currentView === 'calendar' && calendar) {
                                    updateCalendarEvents();
                                }
                            } else if (bar) {
                                bar.remove();
                            }
                        })
                        .catch(() => {
                            const bar = document.getElementById('bgLoadingBar');
                            if (bar) bar.textContent = 'âš ï¸ ë©œë¡ Â·YES24 ì¶”ê°€ ë¡œë”© ì‹¤íŒ¨ (Selenium í•„ìš”)';
                        });
                } else {
                    resultsDiv.innerHTML = `<div class="empty-state"><h3>ì˜¤ë¥˜ ë°œìƒ</h3><p>${fastResult.error}</p></div>`;
                }
            } catch (error) {
                clearInterval(tipInterval);
                resultsDiv.innerHTML = `<div class="empty-state"><h3>ì˜¤ë¥˜ ë°œìƒ</h3><p>${error.message}</p></div>`;
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(stats) {
            document.getElementById('totalCount').textContent = stats.total || 0;
            document.getElementById('kopisCount').textContent = stats.kopis || 0;
            document.getElementById('interparkCount').textContent = stats.interpark || 0;
            document.getElementById('melonCount').textContent = stats.melon || 0;
            document.getElementById('yes24Count').textContent = stats.yes24 || 0;
        }

        // D-day ë±ƒì§€ ìƒì„±
        function getDdayBadge(dday) {
            if (dday === null || dday === undefined) return '';

            let className = 'dday-normal';
            let text = '';

            if (dday < 0) {
                text = 'ì¢…ë£Œ';
                className = 'dday-normal';
            } else if (dday === 0) {
                text = 'D-Day';
                className = 'dday-urgent';
            } else if (dday <= 7) {
                text = `D-${dday}`;
                className = 'dday-urgent';
            } else if (dday <= 14) {
                text = `D-${dday}`;
                className = 'dday-soon';
            } else {
                text = `D-${dday}`;
                className = 'dday-normal';
            }

            return `<span class="dday-badge ${className}">${text}</span>`;
        }

        // ì§€ì—­ ìƒ‰ìƒ ë°˜í™˜
        function getRegionColor(region) {
            const colors = {
                'ì„œìš¸': '#2563EB',
                'ê²½ê¸°Â·ì¸ì²œ': '#059669',
                'ê°•ì›': '#0891B2',
                'ì¶©ì²­': '#7C3AED',
                'ì „ë¼': '#EA580C',
                'ê²½ìƒ': '#DC2626',
                'ì œì£¼': '#DB2777'
            };
            return colors[region] || '#888';
        }

        // íŒë§¤ì²˜ ë±ƒì§€ ìƒì„±
        function getSiteBadges(availableSites) {
            if (!availableSites || availableSites.length === 0) return '';

            return availableSites.map(site => {
                const icon = site.name === 'KOPIS' ? 'K' :
                            site.name === 'ì¸í„°íŒŒí¬' ? 'I' :
                            site.name === 'ë©œë¡ í‹°ì¼“' ? 'M' :
                            site.name === 'YES24' ? 'Y' : '?';
                return `<span class="site-badge" style="background: ${site.color}30; color: ${site.color}" title="${site.name}">${icon}</span>`;
            }).join('');
        }

        // ê²°ê³¼ ë Œë”ë§
        function renderResults() {
            const resultsDiv = document.getElementById('results');
            let html = '';

            // ê²€ìƒ‰ì–´ í•„í„°
            const keyword = document.getElementById('keyword').value.trim().toLowerCase();

            // í•„í„° ì ìš©
            let filteredData = allData;

            // 1. íŒŒíŠ¸ í•„í„°ë§ (concert / theater)
            filteredData = filteredData.filter(item => {
                const itemPart = item.part || 'concert';
                return itemPart === currentPart;
            });

            // 2. ì†ŒìŠ¤ í•„í„°ë§
            if (currentSource !== 'all') {
                filteredData = filteredData.filter(item => {
                    if (item.available_sites) {
                        return item.available_sites.some(site => site.name === currentSource);
                    }
                    return item.source === currentSource;
                });
            }

            // 3. ì§€ì—­ í•„í„°ë§
            if (currentRegion !== 'all') {
                filteredData = filteredData.filter(item => item.region === currentRegion);
            }

            // 4. ê²€ìƒ‰ì–´ í•„í„°ë§
            if (keyword) {
                filteredData = filteredData.filter(item => {
                    const name = (item.name || '').toLowerCase();
                    const venue = (item.venue || '').toLowerCase();
                    return name.includes(keyword) || venue.includes(keyword);
                });
            }

            // 5. ì¥ë¥´ í•„í„°ë§ (ì½˜ì„œíŠ¸ íŒŒíŠ¸ì—ì„œë§Œ)
            if (currentPart === 'concert' && currentFilter !== 'all') {
                filteredData = filteredData.filter(item => item.category === currentFilter);
            }

            // 6. ê´€ì‹¬ ê³µì—°ë§Œ ë³´ê¸° í•„í„°
            if (favFilterActive) {
                const favs = getFavorites();
                filteredData = filteredData.filter(item => item.hash && favs[item.hash]);
            }

            if (filteredData.length > 0) {
                const countText = currentLang === 'ko' || currentLang === 'ja' || currentLang === 'zh' ?
                    `(${filteredData.length}${t('count')})` : `(${filteredData.length})`;
                html += `
                    <div class="source-section">
                        <h3>
                            <span class="source-icon" style="background: #7c3aed30; color: #7c3aed">ğŸ«</span>
                            ${t('performanceList')} ${countText} - ${t('sortByDday')}
                        </h3>
                        <div class="results-grid">
                `;

                filteredData.forEach((item) => {
                    const ddayBadge = getDdayBadge(item.dday);
                    const siteBadges = getSiteBadges(item.available_sites);
                    const categoryBadge = item.category ?
                        `<span class="category-badge">${item.category}</span>` : '';

                    // YES24/ë©œë¡  ì´ë¯¸ì§€ëŠ” ìºì‹± í”„ë¡ì‹œ ì‚¬ìš©
                    let posterUrl = item.poster || '';
                    if (posterUrl && (posterUrl.includes('yes24.com') || posterUrl.includes('melon.com') || posterUrl.includes('tkfile'))) {
                        posterUrl = '/api/proxy/image?url=' + encodeURIComponent(posterUrl);
                    }

                    const isFav = isFavorite(item.hash);

                    const displayName = getTranslatedText(item, 'name') || t('noTitle');
                    const displayVenue = getTranslatedText(item, 'venue');

                    html += `
                        <div class="card" data-hash="${item.hash}">
                            <div class="card-img">
                                ${posterUrl ? `<img src="${posterUrl}" alt="${displayName}" loading="lazy" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('no-poster');">` : ''}
                                ${ddayBadge}
                                ${categoryBadge}
                                <button class="fav-btn ${isFav ? 'active' : ''}" data-hash="${item.hash}" onclick="event.stopPropagation(); toggleFavorite('${item.hash}', this);" title="${t('addFavorite')}">${isFav ? 'â™¥' : 'â™¡'}</button>
                            </div>
                            <div class="card-body">
                                <div class="card-title">${displayName}</div>
                                ${displayVenue ? `<div class="card-info"><span>${t('venue')}</span> ${displayVenue}</div>` : ''}
                                ${item.start_date ? `<div class="card-info"><span>${t('period')}</span> ${item.start_date} ~ ${item.end_date || ''}</div>` : ''}
                                ${item.date ? `<div class="card-info"><span>${t('date')}</span> ${item.date}</div>` : ''}
                                ${item.ticket_open ? `<div class="card-info"><span>${t('ticketOpen')}</span> ${item.ticket_open}</div>` : ''}
                                <div class="site-badges">${siteBadges}</div>
                                ${item.region ? `<span class="region-badge" style="background: ${getRegionColor(item.region)}30; color: ${getRegionColor(item.region)}">${item.region}</span>` : ''}
                            </div>
                        </div>
                    `;
                });

                html += '</div></div>';
            }

            if (!html) {
                html = `<div class="empty-state"><h3>${t('noResults')}</h3><p>${t('tryOther')}</p></div>`;
            }

            resultsDiv.innerHTML = html;
        }

        // hashë¡œ ìƒì„¸ íŒì—… í‘œì‹œ
        function showDetailByHash(hash) {
            const item = allDataMap[hash];
            if (item) {
                showDetail(item);
            } else {
                console.error('ì•„ì´í…œì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', hash);
            }
        }

        // ìƒì„¸ íŒì—… í‘œì‹œ
        async function showDetail(item) {
            const modal = document.getElementById('modalOverlay');

            // ë²ˆì—­ëœ í…ìŠ¤íŠ¸ ì‚¬ìš©
            const displayName = getTranslatedText(item, 'name') || t('noTitle');
            const displayVenue = getTranslatedText(item, 'venue') || '-';

            // ê¸°ë³¸ ì •ë³´ ì„¤ì • + ì°œ ë²„íŠ¼
            const isFav = isFavorite(item.hash);
            document.getElementById('modalTitle').innerHTML = `${displayName}<button class="modal-fav-btn ${isFav ? 'active' : ''}" onclick="toggleFavorite('${item.hash}', this, true)">${isFav ? 'â™¥ ' + t('removeFavorite') : 'â™¡ ' + t('addToFavorite')}</button>`;
            document.getElementById('modalVenue').textContent = displayVenue;
            document.getElementById('modalGenre').textContent = item.genre || '-';
            document.getElementById('modalState').textContent = item.state || '-';
            document.getElementById('modalTicketOpen').textContent = item.ticket_open || '-';

            // ë‚ ì§œ ì •ë³´
            if (item.start_date) {
                document.getElementById('modalDate').textContent = `${item.start_date} ~ ${item.end_date || ''}`;
            } else if (item.date) {
                document.getElementById('modalDate').textContent = item.date;
            } else {
                document.getElementById('modalDate').textContent = '-';
            }

            // í¬ìŠ¤í„° (YES24/ë©œë¡ ì€ ìºì‹± í”„ë¡ì‹œ ì‚¬ìš©)
            const posterDiv = document.getElementById('modalPoster');
            if (item.poster) {
                let modalPosterUrl = item.poster;
                if (modalPosterUrl.includes('yes24.com') || modalPosterUrl.includes('melon.com') || modalPosterUrl.includes('tkfile')) {
                    modalPosterUrl = '/api/proxy/image?url=' + encodeURIComponent(modalPosterUrl);
                }
                posterDiv.innerHTML = `<img src="${modalPosterUrl}" alt="${displayName}" onerror="this.parentElement.innerHTML='<span>No Image</span>'">`;
            } else {
                posterDiv.innerHTML = '<span>No Image</span>';
            }

            // D-day
            const ddayDiv = document.getElementById('modalDday');
            if (item.dday !== null && item.dday !== undefined) {
                let ddayText = item.dday === 0 ? 'D-Day' : (item.dday > 0 ? `D-${item.dday}` : 'ì¢…ë£Œ');
                let ddayClass = item.dday <= 7 ? 'dday-urgent' : (item.dday <= 14 ? 'dday-soon' : 'dday-normal');
                ddayDiv.textContent = ddayText;
                ddayDiv.className = `modal-dday ${ddayClass}`;
                ddayDiv.style.display = 'inline-block';
            } else {
                ddayDiv.style.display = 'none';
            }

            // ì˜ˆë§¤ ë§í¬ ì˜ì—­ ì´ˆê¸°í™”
            const linksDiv = document.getElementById('modalLinks');
            linksDiv.innerHTML = '<p style="color: #888;">ì˜ˆë§¤ ì •ë³´ ë¡œë”© ì¤‘...</p>';

            // KOPISì¸ ê²½ìš° ìƒì„¸ ì •ë³´ + ì‹¤ì œ ì˜ˆë§¤ ë§í¬ ë¡œë“œ
            if (item.id) {
                try {
                    const response = await fetch(`/api/kopis/performance/${item.id}`);
                    const result = await response.json();
                    if (result.success) {
                        const detail = result.data;
                        document.getElementById('modalPrice').textContent = detail.price || '-';
                        document.getElementById('modalCast').textContent = detail.cast || '-';
                        if (detail.schedule) {
                            document.getElementById('modalDate').textContent += ` (${detail.schedule})`;
                        }

                        // ì‹¤ì œ ì˜ˆë§¤ ë§í¬ í‘œì‹œ (KOPIS APIì—ì„œ ì œê³µ)
                        let linksHtml = '';
                        if (detail.booking_sites && detail.booking_sites.length > 0) {
                            detail.booking_sites.forEach(site => {
                                linksHtml += `<a href="${site.url}" target="_blank" class="modal-link-btn" style="background: ${site.color}; color: #fff;">${site.name} ì˜ˆë§¤</a>`;
                            });
                            linksDiv.innerHTML = linksHtml;
                        } else {
                            linksDiv.innerHTML = '<p style="color: #888;">ë“±ë¡ëœ ì˜ˆë§¤ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                        }
                    } else {
                        document.getElementById('modalPrice').textContent = '-';
                        document.getElementById('modalCast').textContent = '-';
                        linksDiv.innerHTML = '<p style="color: #888;">ì˜ˆë§¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                } catch (e) {
                    console.log('ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', e);
                    document.getElementById('modalPrice').textContent = '-';
                    document.getElementById('modalCast').textContent = '-';
                    linksDiv.innerHTML = '<p style="color: #888;">ì˜ˆë§¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } else {
                // KOPIS IDê°€ ì—†ëŠ” ê²½ìš° (í¬ë¡¤ë§ ë°ì´í„°) - ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œ
                document.getElementById('modalPrice').textContent = '-';
                document.getElementById('modalCast').textContent = '-';

                // ì˜ˆë§¤ ë§í¬ í‘œì‹œ
                let linksHtml = '';
                if (item.available_sites && item.available_sites.length > 0) {
                    item.available_sites.forEach(site => {
                        if (site.link && site.link !== '') {
                            linksHtml += `<a href="${site.link}" target="_blank" class="modal-link-btn" style="background: ${site.color}; color: #fff;">${site.name} ì˜ˆë§¤</a>`;
                        }
                    });
                }
                linksDiv.innerHTML = linksHtml || '<p style="color: #888;">ì˜ˆë§¤ ë§í¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            modal.classList.add('active');
            document.body.classList.add('modal-open');
            document.body.style.overflow = 'hidden';
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
        }

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // iOS í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™” - ì¹´ë“œ í´ë¦­ (ì´ë²¤íŠ¸ ìœ„ì„)
        document.getElementById('results').addEventListener('click', function(e) {
            const card = e.target.closest('.card');
            if (card) {
                const hash = card.dataset.hash;
                if (hash) {
                    e.preventDefault();
                    showDetailByHash(hash);
                }
            }
        });

        // iOSì—ì„œ ëª¨ë‹¬ ë‹«ê¸° í„°ì¹˜ ì´ë²¤íŠ¸
        document.getElementById('modalOverlay').addEventListener('touchend', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // ê²€ìƒ‰ì–´ ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ í•„í„°ë§
        document.getElementById('keyword').addEventListener('input', function(e) {
            if (allData.length > 0) {
                renderResults();
            }
        });

        // Enter í‚¤ë¡œ ë°ì´í„° ìƒˆë¡œ ë¡œë“œ
        document.getElementById('keyword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadAllData();
            }
        });

        // =============================================
        // ê´€ì‹¬ ê³µì—° (ì°œ) ê´€ë¦¬ - LocalStorage
        // =============================================

        function getFavorites() {
            try {
                return JSON.parse(localStorage.getItem('ticket_favorites') || '{}');
            } catch { return {}; }
        }

        function saveFavorites(favs) {
            localStorage.setItem('ticket_favorites', JSON.stringify(favs));
        }

        function isFavorite(hash) {
            if (!hash) return false;
            const favs = getFavorites();
            return !!favs[hash];
        }

        function toggleFavorite(hash, btnEl, isModal) {
            if (!hash) return;
            const favs = getFavorites();
            const item = allDataMap[hash];

            if (favs[hash]) {
                // ì°œ í•´ì œ
                delete favs[hash];
                if (btnEl) {
                    if (isModal) {
                        btnEl.classList.remove('active');
                        btnEl.innerHTML = 'â™¡ ì°œí•˜ê¸°';
                    } else {
                        btnEl.classList.remove('active');
                        btnEl.textContent = 'â™¡';
                    }
                }
            } else {
                // ì°œ ë“±ë¡
                if (item) {
                    favs[hash] = {
                        name: item.name || '',
                        ticket_open: item.ticket_open || '',
                        dday: item.dday,
                        start_date: item.start_date || '',
                        venue: item.venue || ''
                    };
                }
                if (btnEl) {
                    if (isModal) {
                        btnEl.classList.add('active');
                        btnEl.innerHTML = 'â™¥ ì°œ í•´ì œ';
                    } else {
                        btnEl.classList.add('active');
                        btnEl.textContent = 'â™¥';
                    }
                }
            }

            saveFavorites(favs);
            updateFavCount();

            // ì¹´ë“œì˜ ì°œ ë²„íŠ¼ ìƒíƒœë„ ë™ê¸°í™”
            if (isModal) {
                const cardBtn = document.querySelector(`.fav-btn[data-hash="${hash}"]`);
                if (cardBtn) {
                    if (favs[hash]) {
                        cardBtn.classList.add('active');
                        cardBtn.textContent = 'â™¥';
                    } else {
                        cardBtn.classList.remove('active');
                        cardBtn.textContent = 'â™¡';
                    }
                }
            }
        }

        function updateFavCount() {
            const favs = getFavorites();
            const count = Object.keys(favs).length;
            document.getElementById('favCount').textContent = count;
        }

        function toggleFavFilter() {
            favFilterActive = !favFilterActive;
            const badge = document.getElementById('favCountBadge');
            if (favFilterActive) {
                badge.classList.add('filter-active');
            } else {
                badge.classList.remove('filter-active');
            }
            renderResults();
        }


        // =============================================
        // ë¸Œë¼ìš°ì € ì•Œë¦¼ (Notification API)
        // =============================================

        let notiCheckInterval = null;

        // ê¸°ê¸° ê°ì§€: iOS ë˜ëŠ” ë„¤ì´ë²„ì•±ì¸ì§€ í™•ì¸
        function isUnsupportedDevice() {
            const ua = navigator.userAgent || '';
            const isIOS = /iPhone|iPad|iPod/i.test(ua);
            const isNaverApp = /NAVER/i.test(ua);
            return isIOS || isNaverApp;
        }

        function toggleNotification(enabled) {
            const statusEl = document.getElementById('notiStatus');

            // iOS/ë„¤ì´ë²„ì•±ì€ ì•Œë¦¼ ë¯¸ì§€ì›
            if (isUnsupportedDevice()) {
                alert('iOS ë˜ëŠ” ë„¤ì´ë²„ ì•±ì—ì„œëŠ” ë¸Œë¼ìš°ì € ì•Œë¦¼ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nSafariì—ì„œ í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ê±°ë‚˜, Chrome/Samsung ë¸Œë¼ìš°ì €ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.');
                document.getElementById('notiToggle').checked = false;
                statusEl.textContent = 'ë¯¸ì§€ì› ê¸°ê¸°';
                statusEl.style.color = '#ff4444';
                return;
            }

            if (enabled) {
                // ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
                if (!('Notification' in window)) {
                    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    document.getElementById('notiToggle').checked = false;
                    return;
                }

                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        localStorage.setItem('ticket_noti_enabled', 'true');
                        statusEl.textContent = 'í™œì„±';
                        statusEl.style.color = '#ff4081';
                        startNotiCheck();
                    } else {
                        document.getElementById('notiToggle').checked = false;
                        localStorage.setItem('ticket_noti_enabled', 'false');
                        statusEl.textContent = 'ê¶Œí•œ ê±°ë¶€ë¨';
                        statusEl.style.color = '#ff4444';
                    }
                });
            } else {
                localStorage.setItem('ticket_noti_enabled', 'false');
                statusEl.textContent = 'ë¹„í™œì„±';
                statusEl.style.color = '#666';
                stopNotiCheck();
            }
        }

        function startNotiCheck() {
            // 30ë¶„ë§ˆë‹¤ D-day ì²´í¬
            if (notiCheckInterval) clearInterval(notiCheckInterval);
            checkFavoriteDdays(); // ì¦‰ì‹œ 1íšŒ ì²´í¬
            notiCheckInterval = setInterval(checkFavoriteDdays, 30 * 60 * 1000);
        }

        function stopNotiCheck() {
            if (notiCheckInterval) {
                clearInterval(notiCheckInterval);
                notiCheckInterval = null;
            }
        }

        function checkFavoriteDdays() {
            if (localStorage.getItem('ticket_noti_enabled') !== 'true') return;
            if (Notification.permission !== 'granted') return;

            const favs = getFavorites();
            const todayKey = new Date().toISOString().split('T')[0].replace(/-/g, '.');
            const notifiedKey = `ticket_notified_${todayKey}`;

            // ì˜¤ëŠ˜ ì´ë¯¸ ì•Œë¦¼ ë³´ë‚¸ ëª©ë¡
            let notified = {};
            try {
                notified = JSON.parse(localStorage.getItem(notifiedKey) || '{}');
            } catch { notified = {}; }

            for (const [hash, info] of Object.entries(favs)) {
                if (notified[hash]) continue; // í•˜ë£¨ 1íšŒ ì¤‘ë³µ ë°©ì§€

                const dday = info.dday;
                // ticket_openì´ ìˆìœ¼ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ D-day ì¬ê³„ì‚°
                let currentDday = dday;
                if (info.ticket_open) {
                    const match = info.ticket_open.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (match) {
                        const target = new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        currentDday = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
                    }
                }

                // D-1 ë˜ëŠ” D-Dayì—ë§Œ ì•Œë¦¼
                if (currentDday === 1 || currentDday === 0) {
                    const title = currentDday === 0 ? 'ì˜¤ëŠ˜ ì˜ˆë§¤ ì˜¤í”ˆ!' : 'ë‚´ì¼ ì˜ˆë§¤ ì˜¤í”ˆ!';
                    const body = `${info.name}\n${info.ticket_open || ''} | ${info.venue || ''}`;

                    const notification = new Notification(title, {
                        body: body,
                        icon: 'ğŸ«',
                        tag: hash,
                        requireInteraction: true
                    });

                    notification.onclick = function() {
                        window.focus();
                        // í•´ë‹¹ ê³µì—° ìƒì„¸ íŒì—… ì—´ê¸°
                        const item = allDataMap[hash];
                        if (item) showDetail(item);
                        notification.close();
                    };

                    // ì•Œë¦¼ ë°œì†¡ ê¸°ë¡
                    notified[hash] = true;
                    localStorage.setItem(notifiedKey, JSON.stringify(notified));
                }
            }

            // ì˜¤ë˜ëœ ì•Œë¦¼ ê¸°ë¡ ì •ë¦¬ (3ì¼ ì´ì „ ê²ƒ ì‚­ì œ)
            cleanupOldNotifiedRecords();
        }

        function cleanupOldNotifiedRecords() {
            const today = new Date();
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('ticket_notified_')) {
                    const dateStr = key.replace('ticket_notified_', '');
                    try {
                        const parts = dateStr.split('.');
                        const recordDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                        const daysDiff = Math.floor((today - recordDate) / (1000 * 60 * 60 * 24));
                        if (daysDiff > 3) {
                            localStorage.removeItem(key);
                        }
                    } catch {}
                }
            }
        }

        // ì•Œë¦¼ ì´ˆê¸° ìƒíƒœ ë³µì›
        function initNotification() {
            const toggle = document.getElementById('notiToggle');
            const statusEl = document.getElementById('notiStatus');

            // iOS/ë„¤ì´ë²„ì•±ì€ ì•Œë¦¼ UI ë¹„í™œì„±í™”
            if (isUnsupportedDevice()) {
                toggle.disabled = true;
                statusEl.textContent = 'ë¯¸ì§€ì› ê¸°ê¸°';
                statusEl.style.color = '#888';
                updateFavCount();
                return;
            }

            const enabled = localStorage.getItem('ticket_noti_enabled') === 'true';

            if (enabled && Notification.permission === 'granted') {
                toggle.checked = true;
                statusEl.textContent = 'í™œì„±';
                statusEl.style.color = '#ff4081';
                startNotiCheck();
            } else {
                toggle.checked = false;
                localStorage.setItem('ticket_noti_enabled', 'false');
            }

            updateFavCount();
        }


        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì¡°íšŒ
        window.onload = function() {
            applyLanguage();
            initNotification();
            loadAllData();
        };
    </script>
</body>
</html>
