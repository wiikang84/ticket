<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½˜ì„œíŠ¸ í†µí•© ì •ë³´</title>
    <!-- FullCalendar -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
            position: relative;
        }

        .home-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .home-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 5px 20px rgba(0,212,255,0.4);
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1.1rem;
        }

        .update-info {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        .search-box {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .search-box h2 {
            margin-bottom: 20px;
            color: #00d4ff;
        }

        .search-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,212,255,0.4);
        }

        /* ë©”ì¸ íŒŒíŠ¸ íƒ­ (ì½˜ì„œíŠ¸ / ì—°ê·¹&ë®¤ì§€ì»¬) */
        .part-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center;
        }

        .part-tab {
            padding: 15px 40px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 30px;
            color: #aaa;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .part-tab:hover {
            border-color: #7c3aed;
            color: #fff;
        }

        .part-tab.active {
            background: linear-gradient(90deg, #7c3aed, #00d4ff);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 5px 20px rgba(124, 58, 237, 0.4);
        }

        /* ì†ŒìŠ¤ íƒ­ (ì „ì²´/KOPIS/ì¸í„°íŒŒí¬ ë“±) */
        .source-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .source-tab {
            padding: 8px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            color: #888;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .source-tab:hover, .source-tab.active {
            background: rgba(255,255,255,0.15);
            color: #fff;
            border-color: #00d4ff;
        }

        /* ì§€ì—­ í•„í„° íƒ­ */
        .region-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .region-tab {
            padding: 6px 14px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 20px;
            color: #888;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .region-tab:hover {
            color: #fff;
            border-color: #7c3aed;
        }

        .region-tab.active {
            background: rgba(124, 58, 237, 0.3);
            color: #fff;
            border-color: #7c3aed;
        }

        .region-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:hover, .tab-btn.active {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
            border-color: transparent;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            max-height: 380px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: #00d4ff;
        }

        .card-img {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #2a2a4a, #1a1a3e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-img.no-poster::after {
            content: 'No Image';
            color: #555;
            font-size: 0.9rem;
        }

        .dday-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .category-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            background: rgba(124, 58, 237, 0.9);
            color: #fff;
        }

        /* ë·° ì „í™˜ íƒ­ */
        .view-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .view-tab {
            padding: 12px 30px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 30px;
            color: #888;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .view-tab:hover, .view-tab.active {
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            color: #fff;
            border-color: transparent;
        }

        /* ëª©ë¡ ë·° */
        .list-view {
            display: block;
        }

        /* ìº˜ë¦°ë” ì»¨í…Œì´ë„ˆ */
        .calendar-container {
            display: none;
            margin-top: 20px;
        }

        .calendar-container.active {
            display: block;
        }

        .calendar-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .calendar-tab {
            padding: 10px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-tab:hover, .calendar-tab.active {
            background: #ff6464;
            color: #fff;
            border-color: transparent;
        }

        .calendar-tab.concert-tab.active {
            background: #00cd3c;
        }

        .calendar-wrapper {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* FullCalendar ë‹¤í¬ í…Œë§ˆ */
        .fc {
            --fc-border-color: rgba(255,255,255,0.1);
            --fc-button-bg-color: rgba(255,255,255,0.1);
            --fc-button-border-color: rgba(255,255,255,0.2);
            --fc-button-hover-bg-color: #7c3aed;
            --fc-button-hover-border-color: #7c3aed;
            --fc-button-active-bg-color: #00d4ff;
            --fc-button-active-border-color: #00d4ff;
            --fc-today-bg-color: rgba(124, 58, 237, 0.2);
            --fc-event-bg-color: #ff6464;
            --fc-event-border-color: #ff6464;
            --fc-page-bg-color: transparent;
        }

        .fc .fc-toolbar-title {
            color: #fff;
            font-size: 1.3rem;
        }

        .fc .fc-button {
            color: #fff;
        }

        .fc .fc-col-header-cell-cushion,
        .fc .fc-daygrid-day-number {
            color: #ccc;
        }

        .fc .fc-day-today {
            background: rgba(124, 58, 237, 0.2) !important;
        }

        .fc-event {
            cursor: pointer;
            font-size: 0.75rem;
            padding: 2px 5px;
            border-radius: 4px;
        }

        .fc-event.ticket-open {
            background: #ff6464 !important;
            border-color: #ff6464 !important;
        }

        .fc-event.concert-date {
            background: #00cd3c !important;
            border-color: #00cd3c !important;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .home-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
                left: 10px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            header p {
                font-size: 0.85rem;
            }

            .part-tabs {
                gap: 10px;
            }

            .part-tab {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .source-tabs {
                gap: 5px;
            }

            .source-tab {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .region-tabs {
                gap: 5px;
            }

            .region-tab {
                padding: 5px 10px;
                font-size: 0.75rem;
            }

            .search-box {
                padding: 15px;
            }

            .search-box h2 {
                font-size: 1.1rem;
            }

            .search-form {
                flex-direction: column;
            }

            .form-group {
                width: 100%;
                min-width: unset;
            }

            .btn {
                width: 100%;
                padding: 15px;
            }

            .view-tabs {
                flex-direction: row;
                gap: 5px;
            }

            .view-tab {
                flex: 1;
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 10px;
                -webkit-overflow-scrolling: touch;
            }

            .tab-btn {
                padding: 8px 15px;
                font-size: 0.8rem;
                flex-shrink: 0;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 10px;
            }

            .card {
                max-height: 320px;
            }

            .card-img {
                height: 140px;
            }

            .card-body {
                padding: 10px;
            }

            .card-title {
                font-size: 0.85rem;
            }

            .card-info {
                font-size: 0.75rem;
            }

            .category-badge {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            .dday-badge {
                font-size: 0.7rem;
                padding: 3px 8px;
            }

            .site-badges {
                gap: 4px;
            }

            .site-badge {
                width: 24px;
                height: 24px;
                font-size: 0.7rem;
            }

            .stats-bar {
                gap: 8px;
            }

            .stat-item {
                padding: 8px 12px;
                min-width: 60px;
            }

            .stat-number {
                font-size: 1.2rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }

            .calendar-tabs {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }

            .calendar-tab {
                padding: 8px 15px;
                font-size: 0.85rem;
            }

            .calendar-wrapper {
                padding: 10px;
            }

            .fc .fc-toolbar {
                flex-direction: column;
                gap: 10px;
            }

            .fc .fc-toolbar-title {
                font-size: 1rem;
            }

            .fc .fc-button {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            /* ëª¨ë‹¬ ëª¨ë°”ì¼ */
            .modal {
                margin: 5px;
                max-height: 95vh;
            }

            .modal-poster {
                height: 180px;
            }

            .modal-content {
                padding: 15px;
            }

            .modal-title {
                font-size: 1.1rem;
            }

            .modal-info-item {
                padding: 8px 0;
            }

            .modal-info-label {
                width: 60px;
                font-size: 0.85rem;
            }

            .modal-info-value {
                font-size: 0.85rem;
            }

            .modal-link-btn {
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            footer {
                padding: 20px;
            }

            footer p {
                font-size: 0.75rem;
            }
        }

        /* ì‘ì€ ëª¨ë°”ì¼ */
        @media (max-width: 480px) {
            .results-grid {
                grid-template-columns: 1fr;
            }

            .card {
                max-height: none;
            }

            .card-img {
                height: 180px;
            }
        }

        .dday-urgent {
            background: #ff4444;
            color: #fff;
        }

        .dday-soon {
            background: #ffaa00;
            color: #000;
        }

        .dday-normal {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }

        .card-body {
            padding: 15px;
            overflow: hidden;
        }

        .card-title {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #fff;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            max-height: 2.8em;
        }

        .card-info {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .card-info span {
            color: #00d4ff;
        }

        .card-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            margin-top: 10px;
        }

        .site-badges {
            display: flex;
            gap: 6px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .site-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: default;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #888;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 15px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #888;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 12px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 100px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
        }

        .source-section {
            margin-bottom: 40px;
        }

        .source-section h3 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .source-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        .modal-overlay.active {
            display: flex;
        }

        /* iOS í„°ì¹˜ ìµœì í™” */
        .modal-link-btn {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .modal {
            background: linear-gradient(135deg, #1e1e3f, #2a2a5a);
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            -webkit-overflow-scrolling: touch;
        }

        /* iOS body ìŠ¤í¬ë¡¤ ë°©ì§€ */
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 2px solid #fff;
            color: #fff;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #ff4444;
            border-color: #ff4444;
            transform: scale(1.1);
        }

        .modal-poster {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #2a2a4a, #1a1a3e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
        }

        .modal-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-content {
            padding: 25px;
        }

        .modal-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .modal-dday {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .modal-info {
            margin-bottom: 25px;
        }

        .modal-info-item {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .modal-info-label {
            width: 80px;
            color: #888;
            flex-shrink: 0;
        }

        .modal-info-value {
            color: #fff;
            flex: 1;
        }

        .modal-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .modal-link-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border-radius: 10px;
            text-decoration: none;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .modal-link-btn:hover {
            transform: translateY(-2px);
        }

        .link-interpark {
            background: #ff6464;
            color: #fff;
        }

        .link-melon {
            background: #00cd3c;
            color: #fff;
        }

        .link-yes24 {
            background: #ffc800;
            color: #000;
        }

        .link-kopis {
            background: #00d4ff;
            color: #000;
        }

        footer {
            text-align: center;
            padding: 40px;
            color: #555;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 50px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .search-form {
                flex-direction: column;
            }

            .form-group {
                width: 100%;
            }

            .modal {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="home-btn" onclick="goHome()" title="í™ˆìœ¼ë¡œ">ğŸ </button>
            <h1>ê³µì—° í†µí•© ì •ë³´</h1>
            <p>ì½˜ì„œíŠ¸ Â· ë®¤ì§€ì»¬ Â· ì—°ê·¹ Â· K-POP Â· ë‚´í•œê³µì—°</p>
            <div class="update-info" id="updateInfo">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</div>
        </header>

        <div class="search-box">
            <h2>ê³µì—° ê²€ìƒ‰</h2>
            <div class="search-form">
                <div class="form-group">
                    <label>ê²€ìƒ‰ì–´</label>
                    <input type="text" id="keyword" placeholder="ì•„í‹°ìŠ¤íŠ¸, ê³µì—°ëª… ì…ë ¥...">
                </div>
                <div class="form-group">
                    <label>ì‹œì‘ì¼</label>
                    <input type="date" id="startDate">
                </div>
                <div class="form-group">
                    <label>ì¢…ë£Œì¼</label>
                    <input type="date" id="endDate">
                </div>
                <button class="btn btn-primary" onclick="loadAllData()">ê²€ìƒ‰</button>
            </div>
        </div>

        <!-- ë·° ì „í™˜: ëª©ë¡ / ìº˜ë¦°ë” -->
        <div class="view-tabs">
            <button class="view-tab active" onclick="switchView('list', this)">ğŸ“‹ ëª©ë¡ ë³´ê¸°</button>
            <button class="view-tab" onclick="switchView('calendar', this)">ğŸ“… ìº˜ë¦°ë” ë³´ê¸°</button>
        </div>

        <!-- ëª©ë¡ ë·° -->
        <div id="listView" class="list-view">
            <!-- ë©”ì¸ íŒŒíŠ¸ íƒ­ -->
            <div class="part-tabs">
                <button class="part-tab active" onclick="switchPart('concert', this)">ğŸ¤ ì½˜ì„œíŠ¸</button>
                <button class="part-tab" onclick="switchPart('theater', this)">ğŸ­ ì—°ê·¹ & ë®¤ì§€ì»¬</button>
            </div>

            <!-- ì†ŒìŠ¤ í•„í„° íƒ­ -->
            <div class="source-tabs">
                <button class="source-tab active" onclick="filterSource('all', this)">ì „ì²´</button>
                <button class="source-tab" onclick="filterSource('KOPIS', this)" style="border-color: #00d4ff;">KOPIS</button>
                <button class="source-tab" onclick="filterSource('ì¸í„°íŒŒí¬', this)" style="border-color: #ff6464;">ì¸í„°íŒŒí¬</button>
                <button class="source-tab" onclick="filterSource('ë©œë¡ í‹°ì¼“', this)" style="border-color: #00cd3c;">ë©œë¡ </button>
                <button class="source-tab" onclick="filterSource('YES24', this)" style="border-color: #ffc800;">YES24</button>
            </div>

            <!-- ì§€ì—­ í•„í„° íƒ­ -->
            <div class="region-tabs" id="regionTabs">
                <button class="region-tab active" onclick="filterRegion('all', this)">ì „ì²´</button>
                <button class="region-tab" onclick="filterRegion('ì„œìš¸', this)">ì„œìš¸</button>
                <button class="region-tab" onclick="filterRegion('ê²½ê¸°Â·ì¸ì²œ', this)">ê²½ê¸°Â·ì¸ì²œ</button>
                <button class="region-tab" onclick="filterRegion('ê°•ì›', this)">ê°•ì›</button>
                <button class="region-tab" onclick="filterRegion('ì¶©ì²­', this)">ì¶©ì²­</button>
                <button class="region-tab" onclick="filterRegion('ì „ë¼', this)">ì „ë¼</button>
                <button class="region-tab" onclick="filterRegion('ê²½ìƒ', this)">ê²½ìƒ</button>
                <button class="region-tab" onclick="filterRegion('ì œì£¼', this)">ì œì£¼</button>
            </div>

            <!-- ì½˜ì„œíŠ¸ ì„¸ë¶€ ì¥ë¥´ íƒ­ (ì½˜ì„œíŠ¸ íŒŒíŠ¸ì—ì„œë§Œ í‘œì‹œ) -->
            <div class="tabs" id="genreTabs">
                <button class="tab-btn active" onclick="showTab('all', this)">ğŸ”¥ ì „ì²´</button>
                <button class="tab-btn" onclick="showTab('ì•„ì´ëŒ', this)">ğŸ’œ ì•„ì´ëŒ/K-POP</button>
                <button class="tab-btn" onclick="showTab('ë°œë¼ë“œ', this)">ğŸ¤ ë°œë¼ë“œ</button>
                <button class="tab-btn" onclick="showTab('íŠ¸ë¡œíŠ¸', this)">ğŸ“º íŠ¸ë¡œíŠ¸</button>
                <button class="tab-btn" onclick="showTab('ë©/í™í•©', this)">ğŸ§ ë©/í™í•©</button>
                <button class="tab-btn" onclick="showTab('ë½/ì¸ë””', this)">ğŸ¸ ë½/ì¸ë””</button>
                <button class="tab-btn" onclick="showTab('ë‚´í•œê³µì—°', this)">ğŸŒ ë‚´í•œê³µì—°</button>
                <button class="tab-btn" onclick="showTab('íŒ¬ë¯¸íŒ…', this)">ğŸ‘¥ íŒ¬ë¯¸íŒ…</button>
                <button class="tab-btn" onclick="showTab('í˜ìŠ¤í‹°ë²Œ', this)">ğŸª í˜ìŠ¤í‹°ë²Œ</button>
                <button class="tab-btn" onclick="showTab('ê¸°íƒ€', this)">ğŸ“Œ ê¸°íƒ€</button>
            </div>

        <div class="stats-bar" id="statsBar">
            <div class="stat-item">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">ì „ì²´</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="kopisCount">0</div>
                <div class="stat-label">KOPIS</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="interparkCount">0</div>
                <div class="stat-label">ì¸í„°íŒŒí¬</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="melonCount">0</div>
                <div class="stat-label">ë©œë¡ </div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="yes24Count">0</div>
                <div class="stat-label">YES24</div>
            </div>
        </div>

            <div id="results">
                <div class="empty-state">
                    <h3>ê³µì—° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”</h3>
                    <p>ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê³µì—° ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.</p>
                    <br>
                    <button class="btn btn-primary" onclick="loadAllData()">ì „ì²´ ê³µì—° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
            </div>
        </div><!-- /listView -->

        <!-- ìº˜ë¦°ë” ë·° -->
        <div id="calendarView" class="calendar-container">
            <div class="calendar-tabs">
                <button class="calendar-tab active" onclick="switchCalendar('ticket', this)">ğŸ« ì˜ˆë§¤ì˜¤í”ˆ ìº˜ë¦°ë”</button>
                <button class="calendar-tab concert-tab" onclick="switchCalendar('concert', this)">ğŸ¤ ê³µì—°ì¼ì • ìº˜ë¦°ë”</button>
            </div>
            <div class="calendar-wrapper">
                <div id="calendar"></div>
            </div>
            <div style="margin-top: 15px; text-align: center; color: #888; font-size: 0.85rem;">
                <span style="display: inline-block; width: 12px; height: 12px; background: #ff6464; border-radius: 3px; margin-right: 5px;"></span> ì˜ˆë§¤ì˜¤í”ˆì¼
                <span style="margin-left: 20px; display: inline-block; width: 12px; height: 12px; background: #00cd3c; border-radius: 3px; margin-right: 5px;"></span> ê³µì—°ì¼
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ íŒì—… ëª¨ë‹¬ -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div class="modal-poster" id="modalPoster">
                <span>No Image</span>
            </div>
            <div class="modal-content">
                <h2 class="modal-title" id="modalTitle">ê³µì—°ëª…</h2>
                <div class="modal-dday dday-normal" id="modalDday">D-day</div>
                <div class="modal-info">
                    <div class="modal-info-item">
                        <span class="modal-info-label">ê³µì—°ì¼</span>
                        <span class="modal-info-value" id="modalDate">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ì¥ì†Œ</span>
                        <span class="modal-info-value" id="modalVenue">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ì¥ë¥´</span>
                        <span class="modal-info-value" id="modalGenre">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">í‹°ì¼“ì˜¤í”ˆ</span>
                        <span class="modal-info-value" id="modalTicketOpen">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ê°€ê²©</span>
                        <span class="modal-info-value" id="modalPrice">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ì¶œì—°</span>
                        <span class="modal-info-value" id="modalCast">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">ìƒíƒœ</span>
                        <span class="modal-info-value" id="modalState">-</span>
                    </div>
                </div>
                <div class="modal-links" id="modalLinks">
                    <!-- ì˜ˆë§¤ ë§í¬ ë²„íŠ¼ë“¤ -->
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>ê³µì—° í†µí•© ì •ë³´ ì‹œìŠ¤í…œ v3.1</p>
        <p style="margin-top: 10px; font-size: 0.85rem;">ë°ì´í„° ì¶œì²˜: KOPIS(ê³µì—°ì˜ˆìˆ í†µí•©ì „ì‚°ë§), ì¸í„°íŒŒí¬, ë©œë¡ í‹°ì¼“, YES24</p>
        <p style="margin-top: 5px; font-size: 0.8rem; color: #555;">ì½˜ì„œíŠ¸ / ì—°ê·¹ & ë®¤ì§€ì»¬ íŒŒíŠ¸ ë¶„ë¥˜ Â· 7ê°œ ê¶Œì—­ ì§€ì—­ í•„í„°</p>
    </footer>

    <script>
        // í˜„ì¬ ë‚ ì§œ ì„¤ì •
        const today = new Date();
        const sixtyDaysLater = new Date(today.getTime() + 60 * 24 * 60 * 60 * 1000);

        document.getElementById('startDate').value = today.toISOString().split('T')[0];
        document.getElementById('endDate').value = sixtyDaysLater.toISOString().split('T')[0];

        let allData = [];  // í†µí•©ëœ ê³µì—° ë¦¬ìŠ¤íŠ¸
        let allDataMap = {};  // hash -> item ë§¤í•‘
        let currentFilter = 'all';  // ì¥ë¥´ í•„í„°
        let currentPart = 'concert';  // íŒŒíŠ¸ í•„í„°: concert / theater
        let currentSource = 'all';  // ì†ŒìŠ¤ í•„í„°: all / KOPIS / ì¸í„°íŒŒí¬ / ë©œë¡ í‹°ì¼“ / YES24
        let currentRegion = 'all';  // ì§€ì—­ í•„í„°: all / ì„œìš¸ / ê²½ê¸°Â·ì¸ì²œ / ê°•ì› / ì¶©ì²­ / ì „ë¼ / ê²½ìƒ / ì œì£¼
        let currentView = 'list';  // í˜„ì¬ ë·°: list, calendar
        let currentCalendarType = 'ticket';  // ìº˜ë¦°ë” íƒ€ì…: ticket, concert
        let calendar = null;  // FullCalendar ì¸ìŠ¤í„´ìŠ¤

        // í™ˆìœ¼ë¡œ ì´ë™ (ì´ˆê¸°í™”)
        function goHome() {
            currentPart = 'concert';
            currentSource = 'all';
            currentFilter = 'all';
            document.querySelectorAll('.part-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.part-tab').classList.add('active');
            document.querySelectorAll('.source-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.source-tab').classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.tab-btn').classList.add('active');
            currentRegion = 'all';
            document.querySelectorAll('.region-tab').forEach(b => b.classList.remove('active'));
            document.querySelector('.region-tab').classList.add('active');
            document.getElementById('keyword').value = '';
            document.getElementById('genreTabs').style.display = 'flex';
            loadAllData();
        }

        // íŒŒíŠ¸ ì „í™˜ (ì½˜ì„œíŠ¸ / ì—°ê·¹&ë®¤ì§€ì»¬)
        function switchPart(part, btn) {
            currentPart = part;
            currentFilter = 'all';  // ì¥ë¥´ í•„í„° ì´ˆê¸°í™”
            document.querySelectorAll('.part-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            // ì¥ë¥´ íƒ­ì€ ì½˜ì„œíŠ¸ íŒŒíŠ¸ì—ì„œë§Œ í‘œì‹œ
            const genreTabs = document.getElementById('genreTabs');
            if (part === 'concert') {
                genreTabs.style.display = 'flex';
            } else {
                genreTabs.style.display = 'none';
            }

            // ì¥ë¥´ íƒ­ ì´ˆê¸°í™”
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.tab-btn').classList.add('active');

            renderResults();
            // ìº˜ë¦°ë” ì—…ë°ì´íŠ¸
            if (currentView === 'calendar' && calendar) {
                updateCalendarEvents();
            }
        }

        // ì†ŒìŠ¤ í•„í„°
        function filterSource(source, btn) {
            currentSource = source;
            document.querySelectorAll('.source-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
        }

        // ì§€ì—­ í•„í„°
        function filterRegion(region, btn) {
            currentRegion = region;
            document.querySelectorAll('.region-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
            if (currentView === 'calendar' && calendar) {
                updateCalendarEvents();
            }
        }

        // ë·° ì „í™˜ (ëª©ë¡ / ìº˜ë¦°ë”)
        function switchView(view, btn) {
            currentView = view;
            document.querySelectorAll('.view-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            if (view === 'list') {
                document.getElementById('listView').style.display = 'block';
                document.getElementById('calendarView').classList.remove('active');
            } else {
                document.getElementById('listView').style.display = 'none';
                document.getElementById('calendarView').classList.add('active');
                initCalendar();
            }
        }

        // ìº˜ë¦°ë” íƒ€ì… ì „í™˜ (ì˜ˆë§¤ì˜¤í”ˆ / ê³µì—°ì¼ì •)
        function switchCalendar(type, btn) {
            currentCalendarType = type;
            document.querySelectorAll('.calendar-tab').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            updateCalendarEvents();
        }

        // ìº˜ë¦°ë” ì´ˆê¸°í™”
        function initCalendar() {
            if (calendar) {
                updateCalendarEvents();
                return;
            }

            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,listMonth'
                },
                buttonText: {
                    today: 'ì˜¤ëŠ˜',
                    month: 'ì›”ê°„',
                    list: 'ëª©ë¡'
                },
                height: 'auto',
                eventClick: function(info) {
                    const item = info.event.extendedProps.item;
                    if (item) showDetail(item);
                },
                eventDidMount: function(info) {
                    // íˆ´íŒ ì¶”ê°€
                    info.el.title = info.event.title;
                }
            });
            calendar.render();
            updateCalendarEvents();
        }

        // ìº˜ë¦°ë” ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateCalendarEvents() {
            if (!calendar) return;

            // ê¸°ì¡´ ì´ë²¤íŠ¸ ì‚­ì œ
            calendar.removeAllEvents();

            // íŒŒíŠ¸ + ì§€ì—­ í•„í„° ì ìš©
            let filteredData = allData.filter(item => {
                const itemPart = item.part || 'concert';
                if (itemPart !== currentPart) return false;
                if (currentRegion !== 'all' && item.region !== currentRegion) return false;
                return true;
            });

            // ìƒˆ ì´ë²¤íŠ¸ ì¶”ê°€
            const events = [];
            filteredData.forEach(item => {
                if (currentCalendarType === 'ticket') {
                    // ì˜ˆë§¤ì˜¤í”ˆ ìº˜ë¦°ë” - ticket_open ë‚ ì§œ ì‚¬ìš©
                    if (item.ticket_open) {
                        const dateMatch = item.ticket_open.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                        if (dateMatch) {
                            events.push({
                                title: item.name.substring(0, 20) + (item.name.length > 20 ? '...' : ''),
                                start: `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`,
                                className: 'ticket-open',
                                extendedProps: { item: item }
                            });
                        }
                    }
                } else {
                    // ê³µì—°ì¼ì • ìº˜ë¦°ë” - start_date ë˜ëŠ” date ì‚¬ìš©
                    let dateStr = item.start_date || item.date || '';
                    const dateMatch = dateStr.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (dateMatch) {
                        let endDate = null;
                        if (item.end_date) {
                            const endMatch = item.end_date.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                            if (endMatch) {
                                // ì¢…ë£Œì¼ +1ì¼ (FullCalendarëŠ” ì¢…ë£Œì¼ ë¯¸í¬í•¨)
                                const ed = new Date(`${endMatch[1]}-${endMatch[2]}-${endMatch[3]}`);
                                ed.setDate(ed.getDate() + 1);
                                endDate = ed.toISOString().split('T')[0];
                            }
                        }
                        events.push({
                            title: item.name.substring(0, 20) + (item.name.length > 20 ? '...' : ''),
                            start: `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`,
                            end: endDate,
                            className: 'concert-date',
                            extendedProps: { item: item }
                        });
                    }
                }
            });

            calendar.addEventSource(events);
        }

        // íƒ­ ì „í™˜ (ì„¸ë¶€ ì¥ë¥´ í•„í„°)
        function showTab(filter, btn) {
            currentFilter = filter;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderResults();
        }

        // ì „ì²´ ë°ì´í„° ë¡œë“œ
        async function loadAllData() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

            const startDate = document.getElementById('startDate').value.replace(/-/g, '');
            const endDate = document.getElementById('endDate').value.replace(/-/g, '');

            try {
                const response = await fetch(`/api/all?start_date=${startDate}&end_date=${endDate}`);
                const result = await response.json();

                if (result.success) {
                    allData = result.data;  // í†µí•©ëœ ë¦¬ìŠ¤íŠ¸
                    // hash -> item ë§¤í•‘ ìƒì„±
                    allDataMap = {};
                    allData.forEach(item => {
                        if (item.hash) allDataMap[item.hash] = item;
                    });
                    updateStats(result.stats);
                    document.getElementById('updateInfo').textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${result.timestamp}`;
                    renderResults();
                    // ìº˜ë¦°ë”ê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
                    if (currentView === 'calendar' && calendar) {
                        updateCalendarEvents();
                    }
                } else {
                    resultsDiv.innerHTML = `<div class="empty-state"><h3>ì˜¤ë¥˜ ë°œìƒ</h3><p>${result.error}</p></div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="empty-state"><h3>ì˜¤ë¥˜ ë°œìƒ</h3><p>${error.message}</p></div>`;
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(stats) {
            document.getElementById('totalCount').textContent = stats.total || 0;
            document.getElementById('kopisCount').textContent = stats.kopis || 0;
            document.getElementById('interparkCount').textContent = stats.interpark || 0;
            document.getElementById('melonCount').textContent = stats.melon || 0;
            document.getElementById('yes24Count').textContent = stats.yes24 || 0;
        }

        // D-day ë±ƒì§€ ìƒì„±
        function getDdayBadge(dday) {
            if (dday === null || dday === undefined) return '';

            let className = 'dday-normal';
            let text = '';

            if (dday < 0) {
                text = 'ì¢…ë£Œ';
                className = 'dday-normal';
            } else if (dday === 0) {
                text = 'D-Day';
                className = 'dday-urgent';
            } else if (dday <= 7) {
                text = `D-${dday}`;
                className = 'dday-urgent';
            } else if (dday <= 14) {
                text = `D-${dday}`;
                className = 'dday-soon';
            } else {
                text = `D-${dday}`;
                className = 'dday-normal';
            }

            return `<span class="dday-badge ${className}">${text}</span>`;
        }

        // ì§€ì—­ ìƒ‰ìƒ ë°˜í™˜
        function getRegionColor(region) {
            const colors = {
                'ì„œìš¸': '#2563EB',
                'ê²½ê¸°Â·ì¸ì²œ': '#059669',
                'ê°•ì›': '#0891B2',
                'ì¶©ì²­': '#7C3AED',
                'ì „ë¼': '#EA580C',
                'ê²½ìƒ': '#DC2626',
                'ì œì£¼': '#DB2777'
            };
            return colors[region] || '#888';
        }

        // íŒë§¤ì²˜ ë±ƒì§€ ìƒì„±
        function getSiteBadges(availableSites) {
            if (!availableSites || availableSites.length === 0) return '';

            return availableSites.map(site => {
                const icon = site.name === 'KOPIS' ? 'K' :
                            site.name === 'ì¸í„°íŒŒí¬' ? 'I' :
                            site.name === 'ë©œë¡ í‹°ì¼“' ? 'M' :
                            site.name === 'YES24' ? 'Y' : '?';
                return `<span class="site-badge" style="background: ${site.color}30; color: ${site.color}" title="${site.name}">${icon}</span>`;
            }).join('');
        }

        // ê²°ê³¼ ë Œë”ë§
        function renderResults() {
            const resultsDiv = document.getElementById('results');
            let html = '';

            // ê²€ìƒ‰ì–´ í•„í„°
            const keyword = document.getElementById('keyword').value.trim().toLowerCase();

            // í•„í„° ì ìš©
            let filteredData = allData;

            // 1. íŒŒíŠ¸ í•„í„°ë§ (concert / theater)
            filteredData = filteredData.filter(item => {
                const itemPart = item.part || 'concert';
                return itemPart === currentPart;
            });

            // 2. ì†ŒìŠ¤ í•„í„°ë§
            if (currentSource !== 'all') {
                filteredData = filteredData.filter(item => {
                    if (item.available_sites) {
                        return item.available_sites.some(site => site.name === currentSource);
                    }
                    return item.source === currentSource;
                });
            }

            // 3. ì§€ì—­ í•„í„°ë§
            if (currentRegion !== 'all') {
                filteredData = filteredData.filter(item => item.region === currentRegion);
            }

            // 4. ê²€ìƒ‰ì–´ í•„í„°ë§
            if (keyword) {
                filteredData = filteredData.filter(item => {
                    const name = (item.name || '').toLowerCase();
                    const venue = (item.venue || '').toLowerCase();
                    return name.includes(keyword) || venue.includes(keyword);
                });
            }

            // 5. ì¥ë¥´ í•„í„°ë§ (ì½˜ì„œíŠ¸ íŒŒíŠ¸ì—ì„œë§Œ)
            if (currentPart === 'concert' && currentFilter !== 'all') {
                filteredData = filteredData.filter(item => item.category === currentFilter);
            }

            if (filteredData.length > 0) {
                html += `
                    <div class="source-section">
                        <h3>
                            <span class="source-icon" style="background: #7c3aed30; color: #7c3aed">ğŸ«</span>
                            ê³µì—° ëª©ë¡ (${filteredData.length}ê±´) - D-day ìˆœ ì •ë ¬
                        </h3>
                        <div class="results-grid">
                `;

                filteredData.forEach((item) => {
                    const ddayBadge = getDdayBadge(item.dday);
                    const siteBadges = getSiteBadges(item.available_sites);
                    const categoryBadge = item.category ?
                        `<span class="category-badge">${item.category}</span>` : '';

                    // YES24/ë©œë¡  ì´ë¯¸ì§€ëŠ” ìºì‹± í”„ë¡ì‹œ ì‚¬ìš©
                    let posterUrl = item.poster || '';
                    if (posterUrl && (posterUrl.includes('yes24.com') || posterUrl.includes('melon.com') || posterUrl.includes('tkfile'))) {
                        posterUrl = '/api/proxy/image?url=' + encodeURIComponent(posterUrl);
                    }

                    html += `
                        <div class="card" data-hash="${item.hash}">
                            <div class="card-img">
                                ${posterUrl ? `<img src="${posterUrl}" alt="${item.name}" loading="lazy" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('no-poster');">` : ''}
                                ${ddayBadge}
                                ${categoryBadge}
                            </div>
                            <div class="card-body">
                                <div class="card-title">${item.name || 'ì œëª© ì—†ìŒ'}</div>
                                ${item.venue ? `<div class="card-info"><span>ì¥ì†Œ</span> ${item.venue}</div>` : ''}
                                ${item.start_date ? `<div class="card-info"><span>ê¸°ê°„</span> ${item.start_date} ~ ${item.end_date || ''}</div>` : ''}
                                ${item.date ? `<div class="card-info"><span>ë‚ ì§œ</span> ${item.date}</div>` : ''}
                                ${item.ticket_open ? `<div class="card-info"><span>í‹°ì¼“ì˜¤í”ˆ</span> ${item.ticket_open}</div>` : ''}
                                <div class="site-badges">${siteBadges}</div>
                                ${item.region ? `<span class="region-badge" style="background: ${getRegionColor(item.region)}30; color: ${getRegionColor(item.region)}">${item.region}</span>` : ''}
                            </div>
                        </div>
                    `;
                });

                html += '</div></div>';
            }

            if (!html) {
                html = '<div class="empty-state"><h3>ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3><p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë‚˜ ë‚ ì§œë¡œ ì‹œë„í•´ë³´ì„¸ìš”.</p></div>';
            }

            resultsDiv.innerHTML = html;
        }

        // hashë¡œ ìƒì„¸ íŒì—… í‘œì‹œ
        function showDetailByHash(hash) {
            const item = allDataMap[hash];
            if (item) {
                showDetail(item);
            } else {
                console.error('ì•„ì´í…œì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', hash);
            }
        }

        // ìƒì„¸ íŒì—… í‘œì‹œ
        async function showDetail(item) {
            const modal = document.getElementById('modalOverlay');

            // ê¸°ë³¸ ì •ë³´ ì„¤ì •
            document.getElementById('modalTitle').textContent = item.name || 'ê³µì—°ëª… ì—†ìŒ';
            document.getElementById('modalVenue').textContent = item.venue || '-';
            document.getElementById('modalGenre').textContent = item.genre || '-';
            document.getElementById('modalState').textContent = item.state || '-';
            document.getElementById('modalTicketOpen').textContent = item.ticket_open || '-';

            // ë‚ ì§œ ì •ë³´
            if (item.start_date) {
                document.getElementById('modalDate').textContent = `${item.start_date} ~ ${item.end_date || ''}`;
            } else if (item.date) {
                document.getElementById('modalDate').textContent = item.date;
            } else {
                document.getElementById('modalDate').textContent = '-';
            }

            // í¬ìŠ¤í„° (YES24/ë©œë¡ ì€ ìºì‹± í”„ë¡ì‹œ ì‚¬ìš©)
            const posterDiv = document.getElementById('modalPoster');
            if (item.poster) {
                let modalPosterUrl = item.poster;
                if (modalPosterUrl.includes('yes24.com') || modalPosterUrl.includes('melon.com') || modalPosterUrl.includes('tkfile')) {
                    modalPosterUrl = '/api/proxy/image?url=' + encodeURIComponent(modalPosterUrl);
                }
                posterDiv.innerHTML = `<img src="${modalPosterUrl}" alt="${item.name}" onerror="this.parentElement.innerHTML='<span>No Image</span>'">`;
            } else {
                posterDiv.innerHTML = '<span>No Image</span>';
            }

            // D-day
            const ddayDiv = document.getElementById('modalDday');
            if (item.dday !== null && item.dday !== undefined) {
                let ddayText = item.dday === 0 ? 'D-Day' : (item.dday > 0 ? `D-${item.dday}` : 'ì¢…ë£Œ');
                let ddayClass = item.dday <= 7 ? 'dday-urgent' : (item.dday <= 14 ? 'dday-soon' : 'dday-normal');
                ddayDiv.textContent = ddayText;
                ddayDiv.className = `modal-dday ${ddayClass}`;
                ddayDiv.style.display = 'inline-block';
            } else {
                ddayDiv.style.display = 'none';
            }

            // ì˜ˆë§¤ ë§í¬ ì˜ì—­ ì´ˆê¸°í™”
            const linksDiv = document.getElementById('modalLinks');
            linksDiv.innerHTML = '<p style="color: #888;">ì˜ˆë§¤ ì •ë³´ ë¡œë”© ì¤‘...</p>';

            // KOPISì¸ ê²½ìš° ìƒì„¸ ì •ë³´ + ì‹¤ì œ ì˜ˆë§¤ ë§í¬ ë¡œë“œ
            if (item.id) {
                try {
                    const response = await fetch(`/api/kopis/performance/${item.id}`);
                    const result = await response.json();
                    if (result.success) {
                        const detail = result.data;
                        document.getElementById('modalPrice').textContent = detail.price || '-';
                        document.getElementById('modalCast').textContent = detail.cast || '-';
                        if (detail.schedule) {
                            document.getElementById('modalDate').textContent += ` (${detail.schedule})`;
                        }

                        // ì‹¤ì œ ì˜ˆë§¤ ë§í¬ í‘œì‹œ (KOPIS APIì—ì„œ ì œê³µ)
                        let linksHtml = '';
                        if (detail.booking_sites && detail.booking_sites.length > 0) {
                            detail.booking_sites.forEach(site => {
                                linksHtml += `<a href="${site.url}" target="_blank" class="modal-link-btn" style="background: ${site.color}; color: #fff;">${site.name} ì˜ˆë§¤</a>`;
                            });
                            linksDiv.innerHTML = linksHtml;
                        } else {
                            linksDiv.innerHTML = '<p style="color: #888;">ë“±ë¡ëœ ì˜ˆë§¤ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                        }
                    } else {
                        document.getElementById('modalPrice').textContent = '-';
                        document.getElementById('modalCast').textContent = '-';
                        linksDiv.innerHTML = '<p style="color: #888;">ì˜ˆë§¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                } catch (e) {
                    console.log('ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', e);
                    document.getElementById('modalPrice').textContent = '-';
                    document.getElementById('modalCast').textContent = '-';
                    linksDiv.innerHTML = '<p style="color: #888;">ì˜ˆë§¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } else {
                // KOPIS IDê°€ ì—†ëŠ” ê²½ìš° (í¬ë¡¤ë§ ë°ì´í„°) - ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œ
                document.getElementById('modalPrice').textContent = '-';
                document.getElementById('modalCast').textContent = '-';

                // ì˜ˆë§¤ ë§í¬ í‘œì‹œ
                let linksHtml = '';
                if (item.available_sites && item.available_sites.length > 0) {
                    item.available_sites.forEach(site => {
                        if (site.link && site.link !== '') {
                            linksHtml += `<a href="${site.link}" target="_blank" class="modal-link-btn" style="background: ${site.color}; color: #fff;">${site.name} ì˜ˆë§¤</a>`;
                        }
                    });
                }
                linksDiv.innerHTML = linksHtml || '<p style="color: #888;">ì˜ˆë§¤ ë§í¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            modal.classList.add('active');
            document.body.classList.add('modal-open');
            document.body.style.overflow = 'hidden';
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
        }

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // iOS í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™” - ì¹´ë“œ í´ë¦­ (ì´ë²¤íŠ¸ ìœ„ì„)
        document.getElementById('results').addEventListener('click', function(e) {
            const card = e.target.closest('.card');
            if (card) {
                const hash = card.dataset.hash;
                if (hash) {
                    e.preventDefault();
                    showDetailByHash(hash);
                }
            }
        });

        // iOSì—ì„œ ëª¨ë‹¬ ë‹«ê¸° í„°ì¹˜ ì´ë²¤íŠ¸
        document.getElementById('modalOverlay').addEventListener('touchend', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // ê²€ìƒ‰ì–´ ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ í•„í„°ë§
        document.getElementById('keyword').addEventListener('input', function(e) {
            if (allData.length > 0) {
                renderResults();
            }
        });

        // Enter í‚¤ë¡œ ë°ì´í„° ìƒˆë¡œ ë¡œë“œ
        document.getElementById('keyword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadAllData();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì¡°íšŒ
        window.onload = function() {
            loadAllData();
        };
    </script>
</body>
</html>
